{"ast":null,"code":"import _toConsumableArray from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _slicedToArray from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useHistory,Link}from\"react-router-dom\";import*as emailjs from\"emailjs-com\";import MaterialTable,{MTableToolbar}from\"material-table\";import{makeStyles}from\"@material-ui/core/styles\";import{useIsFetching}from\"react-query\";import{TextField,Icon,Grid,Button}from\"@material-ui/core\";import{Alert}from\"@material-ui/lab\";import{useRecoilValue,useRecoilState}from\"recoil\";import{useCustomToast}from\"../helpers/useCustomToast\";import{loginLevelState,allowsDataState,allowsDataDetlsState,empidState,allowsPeriodState,allowsDataIdState,siteallowsTotalsState}from\"./data/atomdata\";//import { useDailyAllowancesContext } from \"../context/dailyallowances_context\";\nimport{useAddDailyAllowsDetls}from\"./dailyallowsdetls/useAddDailyAllowsDetls\";import{useUpdateDailyAllowsDetls}from\"./dailyallowsdetls/useUpdateDailyAllowsDetls\";import{useDeleteDailyAllowsDetls}from\"./dailyallowsdetls/useDeleteDailyAllowsDetls\";import{useDailyAllowsDetlsBatch}from\"./dailyallowsdetls/useDailyAllowsDetlsBatch\";import{useDailyAllows}from\"./dailyallows/useDailyAllows\";import{useUpdateDailyAllows}from\"./dailyallows/useUpdateDailyAllows\";import{AlertDialogBox}from\"../helpers/AlertDialogBox\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SERVICE_ID=process.env.REACT_APP_EMAILJS_SERVICEID;var TEMPLATE_ID=\"template_1y8odlq\";var USER_ID=process.env.REACT_APP_EMAILJS_USERID;var initial_totals=[{totalamount:0,totalbonus:0,totaldiem:0,totaldays:0}];var columns=[{title:\"Date\",field:\"date\",type:\"date\",dateSetting:{locale:\"en-GB\"},// editable: \"never\",\ncellStyle:{width:120,maxWidth:120},editComponent:function editComponent(props){return/*#__PURE__*/_jsx(TextField,{defaultValue:props.value||null,onChange:function onChange(e){return props.onChange(e.target.value);},type:\"date\"});}},// { title: \"District\", field: \"district\" },\n{title:\"Operation Type\",field:\"typeoperation\"},{title:\"Client\",field:\"client\"},{title:\"Location/Rig\",field:\"location\"},{title:\"Ticket No/Job No\",field:\"jobno\"},{title:\"Operation Role\",field:\"crewoperation\"},{title:\"Job Bonus\",field:\"jobbonus\",type:\"currency\",cellStyle:{width:8,maxWidth:8},headerStyle:{width:8,maxWidth:8}},{title:\"Per Diem\",field:\"perdiem\",type:\"currency\",cellStyle:{width:8,maxWidth:8},headerStyle:{width:8,maxWidth:8}}// { title: \"Delete\", field: \"isdelete\", type: \"boolean\" },\n];export default function DailyAllowsDetlsTableStaff(){var history=useHistory();var toast=useCustomToast();var classes=useStyles();var isFetching=useIsFetching();//const { dailyallowsdetls } = useDailyAllowsDetls()\nvar _useDailyAllows=useDailyAllows(),dailyallows=_useDailyAllows.dailyallows,dailyAllowsId=_useDailyAllows.dailyAllowsId,setDailyAllowsId=_useDailyAllows.setDailyAllowsId;var _useDailyAllowsDetlsB=useDailyAllowsDetlsBatch(),dailyallowsdetls=_useDailyAllowsDetlsB.dailyallowsdetls,setDailyAllowsDetlsId=_useDailyAllowsDetlsB.setDailyAllowsDetlsId,setDailyAllowsDetlsPeriod=_useDailyAllowsDetlsB.setDailyAllowsDetlsPeriod,isLoading=_useDailyAllowsDetlsB.isLoading;var addDailyAllowsDetls=useAddDailyAllowsDetls();var updateDailyAllowsDetls=useUpdateDailyAllowsDetls();var deleteDailyAllowsDetls=useDeleteDailyAllowsDetls();var updateDailyAllows=useUpdateDailyAllows();// const [allowsDetlsTable, setAllowsDetlsTable] =\n// useRecoilState(allowsDataDetlsState);\n//console.log(\"detlstable\", );\n//const [allowsDetlsdata, setAllowsDetilsdata] = useRecoilStateLoadable(fetchDailyAllowsDetlsSelector);\nvar _useRecoilState=useRecoilState(loginLevelState),_useRecoilState2=_slicedToArray(_useRecoilState,2),loginLevel=_useRecoilState2[0],setLoginLevel=_useRecoilState2[1];var _useRecoilState3=useRecoilState(allowsDataDetlsState),_useRecoilState4=_slicedToArray(_useRecoilState3,2),allowsDetlsdata=_useRecoilState4[0],setAllowsDetlsdata=_useRecoilState4[1];var allows_period=useRecoilValue(allowsPeriodState);var allows_empid=useRecoilValue(empidState);var _useRecoilState5=useRecoilState(siteallowsTotalsState),_useRecoilState6=_slicedToArray(_useRecoilState5,2),siteallowsTotals=_useRecoilState6[0],setSiteAllowsTotals=_useRecoilState6[1];var _useRecoilState7=useRecoilState(allowsDataState),_useRecoilState8=_slicedToArray(_useRecoilState7,2),allowsdata=_useRecoilState8[0],setAllowsdata=_useRecoilState8[1];var _useState=useState(allowsDataIdState),_useState2=_slicedToArray(_useState,2),allowsdataId=_useState2[0],setAllowsdataId=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),tabledeldata=_useState4[0],setTableDelData=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isCalc=_useState6[0],setIsCalc=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isBuild=_useState8[0],setIsBuild=_useState8[1];var _useState9=useState({initial_totals:initial_totals}),_useState10=_slicedToArray(_useState9,2),totals=_useState10[0],setTotals=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isSubmitAlertOpen=_useState12[0],setIsSubmitAlertOpen=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isExitAlertOpen=_useState14[0],setIsExitAlertOpen=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),dailyallowsdata=_useState16[0],setDailyAllowsData=_useState16[1];var totalsValues=Object.values(totals).join(\"\");// const {\n//   //dailyallowances,\n//   //dailyallowsdetls,\n//   loadEmpDailyAllowsDetls,\n//   updateDailyAllowance,\n//   //updateDailyAllowsDetl,\n//   //deleteDailyAllowsDetl,\n//   dailyallowsdetl_loading,\n//   dailyallowsdetl_error,\n// } = useDailyAllowancesContext();\nuseEffect(function(){setDailyAllowsId(allows_empid);setDailyAllowsDetlsId(allows_empid);setDailyAllowsDetlsPeriod(allows_period);// setTimeout(() => {\n//   setTotals((prevState) => ({\n//     totalamount: dailyallows.amount,\n//     totalbonus: dailyallows.totaljobbonus,\n//     totaldiem: dailyallows.totalperdiem,\n//     totaldays: dailyallows.no_of_days,\n//   }));\n// }, 3000);\n},[allows_empid,allows_period]);// useEffect(() => {\n//  if (allowsdata) {\n//     handle_tempcalc();\n//     setIsCalc(false);\n//   }\n// }, [isCalc]);\nvar handleSentEmail=function handleSentEmail(data){var period=data.period;//console.log(\"expense form\", loginLevel);\nvar emaildata={to_name:loginLevel.loginUser,to_email:loginLevel.loginEmail,message:\"Your site allowances for the period \".concat(period,\" has been successfully submitted for approval\"),cc_to:loginLevel.reporting_email};emailjs.send(SERVICE_ID,TEMPLATE_ID,emaildata,USER_ID).then(function(response){console.log(response.status,response.text);toast({title:\"Email has sent successfully to \".concat(emaildata.to_email,\"!\"),status:\"success\"});},function(err){console.log(err);toast({title:\"Email has fail to send to \".concat(emaildata.to_email,\"!\"),status:\"warning\"});});};var build_dailyallowsdata=function build_dailyallowsdata(){var id=dailyallowsdetls.id,jobbonus=dailyallowsdetls.jobbonus,perdiem=dailyallowsdetls.perdiem;var data=dailyallowsdetls.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).map(function(rec){return rec.id,rec.jobbonus,rec.perdiem;});setDailyAllowsData(data);console.log(\"dailydata\",dailyallowsdata);};var update_AllowsDetls=function update_AllowsDetls(data,index){var allowsdata=dailyallowsdetls;var id=data.id,rec_id=data.rec_id,tableData=data.tableData,fields=_objectWithoutProperties(data,[\"id\",\"rec_id\",\"tableData\"]);updateDailyAllowsDetls(_objectSpread({id:id},fields));//recalc\nallowsdata[index].jobbonus=data.jobbonus;allowsdata[index].perdiem=data.perdiem;handle_tempcalc(allowsdata);//save_siteallows();\n};var save_siteallows=function save_siteallows(){var id=allowsdata.id;updateDailyAllows(_objectSpread(_objectSpread({id:id},allowsdata),{},{no_of_days:totals.totaldays,amount:totals.totalamount,totaljobbonus:totals.totalbonus,totalperdiem:totals.totaldiem}));};var save_AllowsDetls=function save_AllowsDetls(e){e.preventDefault();// handle calc\n//handle_calc();\n//save allows data details\nvar id=allowsdata.id;updateDailyAllows(_objectSpread(_objectSpread({id:id},allowsdata),{},{no_of_days:totals.totaldays,amount:totals.totalamount,totaljobbonus:totals.totalbonus,totalperdiem:totals.totaldiem}));toast({title:\"Site Allowances table being saved!\",status:\"success\"});};var submit_AllowsDetls=function submit_AllowsDetls(e){e.preventDefault();handleSubmitAlertOpen();};var exit_AllowsDetls=function exit_AllowsDetls(e){e.preventDefault();handleExitAlertOpen();};var handleOnSubmitConfirm=function handleOnSubmitConfirm(){//save allows data details\nvar id=allowsdata.id;updateDailyAllows(_objectSpread(_objectSpread({id:id},allowsdata),{},{no_of_days:totals.totaldays,amount:totals.totalamount,totaljobbonus:totals.totalbonus,totalperdiem:totals.totaldiem,status:\"Submitted\"}));handleSentEmail(allowsdata);history.push(\"/dailyallowances\");toast({title:\"Site Allowances table being submitted!\",status:\"success\"});};var handleOnExitConfirm=function handleOnExitConfirm(){//save allows data details\nvar id=allowsdata.id;updateDailyAllows(_objectSpread(_objectSpread({id:id},allowsdata),{},{no_of_days:totals.totaldays,amount:totals.totalamount,totaljobbonus:totals.totalbonus,totalperdiem:totals.totaldiem}));history.push(\"/dailyallowances\");toast({title:\"Site Allowances table being submitted!\",status:\"success\"});};var handleSubmitAlertOpen=function handleSubmitAlertOpen(){setIsSubmitAlertOpen(true);};var handleSubmitAlertClose=function handleSubmitAlertClose(){setIsSubmitAlertOpen(false);};var handleExitAlertOpen=function handleExitAlertOpen(){setIsExitAlertOpen(true);};var handleExitAlertClose=function handleExitAlertClose(){setIsExitAlertOpen(false);};var handle_calc=function handle_calc(){if(dailyallowsdetls){var totbonus=dailyallowsdetls.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).reduce(function(acc,item){if(isNaN(item.jobbonus)){return acc;}else{return acc+item.jobbonus;}},0);var totdiem=dailyallowsdetls.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).reduce(function(acc,item){if(isNaN(item.perdiem)){return acc;}else{return acc+item.perdiem;}},0);var totdays=dailyallowsdetls.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).reduce(function(acc,item){var val=0;if(item.jobbonus>0||item.perdiem>0){val=1;}else{val=0;}return acc+val;},0);var total=totbonus+totdiem;setTimeout(function(){setTotals({totalamount:total,totalbonus:totbonus,totaldiem:totdiem,totaldays:totdays});},3000);console.log(\"calc\",totdays,totals);}};var handle_tempcalc=function handle_tempcalc(allowsdata){if(allowsdata){var totbonus=allowsdata.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).reduce(function(acc,item){if(isNaN(item.jobbonus)){return acc;}else{return acc+item.jobbonus;}},0);var totdiem=allowsdata.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).reduce(function(acc,item){if(isNaN(item.perdiem)){return acc;}else{return acc+item.perdiem;}},0);var totdays=allowsdata.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).reduce(function(acc,item){var val=0;if(item.jobbonus>0||item.perdiem>0){val=1;}else{val=0;}return acc+val;},0);var total=totbonus+totdiem;var data=dailyallows.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).map(function(rec){return _objectSpread({},rec);});console.log(\"data\",data);updateDailyAllows({id:data[0].id,no_of_days:totdays,amount:total,totaljobbonus:totbonus,totalperdiem:totdiem});// setTimeout(() => {\n//   setTotals({\n//     totalamount: total,\n//     totalbonus: totbonus,\n//     totaldiem: totdiem,\n//     totaldays: totdays,\n//   });\n// }, 3000);\n// console.log(\"tempcalc\", totdays, totals);\n}};var update_SiteAllowsTotals=function update_SiteAllowsTotals(){setSiteAllowsTotals({totalamount:totals.totalamount,totalbonus:dailyallowsdetls.reduce(function(acc,item){if(isNaN(item.jobbonus)){return acc;}else{return acc+item.jobbonus;}},0),totaldiem:totals.totaldiem,totaldays:dailyallowsdetls.reduce(function(acc,item){var val=0;if(item.jobbonus>0||item.perdiem>0){val=1;}else{val=0;}return acc+val;},0)});console.log(\"update\",siteallowsTotals);};// const add_DailyAllowsDetl = async (data) => {\n//   console.log(\"add\", data);\n//   const { description, amount } = data;\n//   addDailyAllowsDetl({\n//     description: description,\n//     amount: amount,\n//     name: single_dailyallowance.name,\n//     empid: single_dailyallowance.empid,\n//     period: dailyallowance_period,\n//   });\n// };\n// const delete_DailyAllowance = (data) => {\n//   const { id } = data;\n//   deleteDailyAllowsDetl(id);\n//   //update_Daily Allowances Details;\n//   getSingleBatchDailyAllowsDetl(\n//     single_dailyallowance.empid,\n//     dailyallowance_period\n//   );\n// };\n//  setAllowsDetlsdata(dailyallowsdetls);\n// console.log(\"load allows detls\", allowsDetlsdata);\nreturn/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(\"div\",{style:{maxWidth:\"75%\",paddingTop:\"5px\"},children:/*#__PURE__*/_jsx(MaterialTable,{columns:columns,data:dailyallowsdetls,title:\"Daily Allowances Details\",editable:{// onRowAdd: (newData) =>\n//   new Promise((resolve, reject) => {\n//     // setTimeout(() => {\n//     //   setAllowsdata([...allowsdata, newData]);\n//     //   resolve();\n//     // }, 1000);\n//   }),\nonRowUpdate:function onRowUpdate(newData,oldData){return new Promise(function(resolve,reject){setTimeout(function(){var dataUpdate=_toConsumableArray(dailyallowsdetls);var index=oldData.tableData.id;dataUpdate[index]=newData;//setDailyAllowsData([...dataUpdate]);\nupdate_AllowsDetls(newData,index);//handle_calc();\n//setAllowsDetlsTable([...dataUpdate]);\n//editable = dataUpdate;\nresolve();},1000);});}// onRowDelete: (oldData) =>\n//   new Promise((resolve, reject) => {\n//     setTimeout(() => {\n//       //const dataDelete = [...allowsDetlsTable];\n//       const index = oldData.tableData.id;\n//       //dataDelete.splice(index, 1);\n//       //setAllowsDetlsTable([...dataDelete]);\n//       resolve();\n//     }, 1000);\n//   }),\n},options:{filtering:true,selection:false,pageSize:10,headerStyle:{backgroundColor:\"orange\",color:\"primary\"},showTitle:true},components:{Toolbar:function Toolbar(props){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(MTableToolbar,_objectSpread({},props)),/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"5px 10px\"},children:[/*#__PURE__*/_jsxs(Button,{type:\"submit\",variant:\"contained\",color:\"secondary\",className:classes.button,onClick:function onClick(e){return submit_AllowsDetls(e);},children:[\"Submit \",/*#__PURE__*/_jsx(Icon,{className:classes.rightIcon,children:\"send\"})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Grid,{container:true,spacing:0,direction:\"row\",style:{border:\"1px solid white\"},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"row\"},children:[/*#__PURE__*/_jsx(TextField,{label:\"Total Job Bonus\",variant:\"filled\",style:{width:\"100%\"},name:\"totalbonus\",value:dailyallows&&dailyallows.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).map(function(rec){return rec.totaljobbonus;}),type:\"currency\",className:classes.textField,InputLabelProps:{shrink:true}}),/*#__PURE__*/_jsx(TextField,{label:\"Total Diem\",variant:\"filled\",style:{width:\"100%\"},name:\"totaldiem\",value:dailyallows&&dailyallows.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).map(function(rec){return rec.totalperdiem;}),type:\"currency\",className:classes.textField,InputLabelProps:{shrink:true}}),/*#__PURE__*/_jsx(TextField,{label:\"No of Days\",variant:\"filled\",style:{width:\"100%\"},name:\"totaldays\",value:dailyallows&&dailyallows.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).map(function(rec){return rec.no_of_days;}),type:\"numeric\",className:classes.textField,InputLabelProps:{shrink:true}}),/*#__PURE__*/_jsx(TextField,{label:\"Total Amount\",variant:\"filled\",style:{width:\"100%\"},name:\"totalamount\",value:dailyallows&&dailyallows.filter(function(r){return r.period===allows_period&&r.empid===allows_empid;}).map(function(rec){return rec.amount;}),type:\"currency\",className:classes.textField,InputLabelProps:{shrink:true}})]})})})]})]});}}})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(AlertDialogBox,{onClose:handleSubmitAlertClose,onConfirm:handleOnSubmitConfirm,isOpen:isSubmitAlertOpen,title:\"Site Allowances Batch\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"After submition for approval, no changes can be made.\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Are you sure you want to submit ?\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(AlertDialogBox,{onClose:handleExitAlertClose,onConfirm:handleOnExitConfirm,isOpen:isExitAlertOpen,title:\"Site Allowances Batch\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Are you sure you want to exit ?\"})})})]});}var useStyles=makeStyles(function(theme){return{root:{padding:0,width:1500},button:{margin:theme.spacing(1)}};});","map":{"version":3,"sources":["D:/react-myprojects/hrms-airtable/src/components/DailyAllowsDetlsTableStaff.js"],"names":["React","useState","useEffect","useHistory","Link","emailjs","MaterialTable","MTableToolbar","makeStyles","useIsFetching","TextField","Icon","Grid","Button","Alert","useRecoilValue","useRecoilState","useCustomToast","loginLevelState","allowsDataState","allowsDataDetlsState","empidState","allowsPeriodState","allowsDataIdState","siteallowsTotalsState","useAddDailyAllowsDetls","useUpdateDailyAllowsDetls","useDeleteDailyAllowsDetls","useDailyAllowsDetlsBatch","useDailyAllows","useUpdateDailyAllows","AlertDialogBox","SERVICE_ID","process","env","REACT_APP_EMAILJS_SERVICEID","TEMPLATE_ID","USER_ID","REACT_APP_EMAILJS_USERID","initial_totals","totalamount","totalbonus","totaldiem","totaldays","columns","title","field","type","dateSetting","locale","cellStyle","width","maxWidth","editComponent","props","value","e","onChange","target","headerStyle","DailyAllowsDetlsTableStaff","history","toast","classes","useStyles","isFetching","dailyallows","dailyAllowsId","setDailyAllowsId","dailyallowsdetls","setDailyAllowsDetlsId","setDailyAllowsDetlsPeriod","isLoading","addDailyAllowsDetls","updateDailyAllowsDetls","deleteDailyAllowsDetls","updateDailyAllows","loginLevel","setLoginLevel","allowsDetlsdata","setAllowsDetlsdata","allows_period","allows_empid","siteallowsTotals","setSiteAllowsTotals","allowsdata","setAllowsdata","allowsdataId","setAllowsdataId","tabledeldata","setTableDelData","isCalc","setIsCalc","isBuild","setIsBuild","totals","setTotals","isSubmitAlertOpen","setIsSubmitAlertOpen","isExitAlertOpen","setIsExitAlertOpen","dailyallowsdata","setDailyAllowsData","totalsValues","Object","values","join","handleSentEmail","data","period","emaildata","to_name","loginUser","to_email","loginEmail","message","cc_to","reporting_email","send","then","response","console","log","status","text","err","build_dailyallowsdata","id","jobbonus","perdiem","filter","r","empid","map","rec","update_AllowsDetls","index","rec_id","tableData","fields","handle_tempcalc","save_siteallows","no_of_days","amount","totaljobbonus","totalperdiem","save_AllowsDetls","preventDefault","submit_AllowsDetls","handleSubmitAlertOpen","exit_AllowsDetls","handleExitAlertOpen","handleOnSubmitConfirm","push","handleOnExitConfirm","handleSubmitAlertClose","handleExitAlertClose","handle_calc","totbonus","reduce","acc","item","isNaN","totdiem","totdays","val","total","setTimeout","update_SiteAllowsTotals","root","paddingTop","onRowUpdate","newData","oldData","Promise","resolve","reject","dataUpdate","filtering","selection","pageSize","backgroundColor","color","showTitle","Toolbar","padding","button","rightIcon","border","display","flexDirection","textField","shrink","theme","margin","spacing"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useHistory, Link } from \"react-router-dom\";\r\nimport * as emailjs from \"emailjs-com\";\r\nimport MaterialTable, { MTableToolbar } from \"material-table\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { useIsFetching } from \"react-query\";\r\nimport { TextField, Icon, Grid, Button } from \"@material-ui/core\";\r\nimport { Alert } from \"@material-ui/lab\";\r\nimport { useRecoilValue, useRecoilState } from \"recoil\";\r\nimport { useCustomToast } from \"../helpers/useCustomToast\";\r\nimport {\r\n  loginLevelState,\r\n  allowsDataState,\r\n  allowsDataDetlsState,\r\n  empidState,\r\n  allowsPeriodState,\r\n  allowsDataIdState,\r\n  siteallowsTotalsState,\r\n} from \"./data/atomdata\";\r\n//import { useDailyAllowancesContext } from \"../context/dailyallowances_context\";\r\nimport { useAddDailyAllowsDetls } from \"./dailyallowsdetls/useAddDailyAllowsDetls\";\r\nimport { useUpdateDailyAllowsDetls } from \"./dailyallowsdetls/useUpdateDailyAllowsDetls\";\r\nimport { useDeleteDailyAllowsDetls } from \"./dailyallowsdetls/useDeleteDailyAllowsDetls\";\r\nimport { useDailyAllowsDetlsBatch } from \"./dailyallowsdetls/useDailyAllowsDetlsBatch\";\r\nimport { useDailyAllows } from \"./dailyallows/useDailyAllows\";\r\nimport { useUpdateDailyAllows } from \"./dailyallows/useUpdateDailyAllows\";\r\nimport { AlertDialogBox } from \"../helpers/AlertDialogBox\";\r\n\r\nconst SERVICE_ID = process.env.REACT_APP_EMAILJS_SERVICEID;\r\nconst TEMPLATE_ID = \"template_1y8odlq\";\r\nconst USER_ID = process.env.REACT_APP_EMAILJS_USERID;\r\n\r\nconst initial_totals = [\r\n  {\r\n    totalamount: 0,\r\n    totalbonus: 0,\r\n    totaldiem: 0,\r\n    totaldays: 0,\r\n  },\r\n];\r\n\r\nconst columns = [\r\n  {\r\n    title: \"Date\",\r\n    field: \"date\",\r\n    type: \"date\",\r\n    dateSetting: { locale: \"en-GB\" },\r\n    // editable: \"never\",\r\n    cellStyle: {\r\n      width: 120,\r\n      maxWidth: 120,\r\n    },\r\n    editComponent: (props) => (\r\n      <TextField\r\n        defaultValue={props.value || null}\r\n        onChange={(e) => props.onChange(e.target.value)}\r\n        type=\"date\"\r\n      />\r\n    ),\r\n  },\r\n  // { title: \"District\", field: \"district\" },\r\n  { title: \"Operation Type\", field: \"typeoperation\" },\r\n  { title: \"Client\", field: \"client\" },\r\n  { title: \"Location/Rig\", field: \"location\" },\r\n  { title: \"Ticket No/Job No\", field: \"jobno\" },\r\n  { title: \"Operation Role\", field: \"crewoperation\" },\r\n  {\r\n    title: \"Job Bonus\",\r\n    field: \"jobbonus\",\r\n    type: \"currency\",\r\n    cellStyle: {\r\n      width: 8,\r\n      maxWidth: 8,\r\n    },\r\n    headerStyle: {\r\n      width: 8,\r\n      maxWidth: 8,\r\n    },\r\n  },\r\n  {\r\n    title: \"Per Diem\",\r\n    field: \"perdiem\",\r\n    type: \"currency\",\r\n    cellStyle: {\r\n      width: 8,\r\n      maxWidth: 8,\r\n    },\r\n    headerStyle: {\r\n      width: 8,\r\n      maxWidth: 8,\r\n    },\r\n  },\r\n  // { title: \"Delete\", field: \"isdelete\", type: \"boolean\" },\r\n];\r\n\r\nexport default function DailyAllowsDetlsTableStaff() {\r\n  let history = useHistory();\r\n  const toast = useCustomToast();\r\n  const classes = useStyles();\r\n  const isFetching = useIsFetching();\r\n  //const { dailyallowsdetls } = useDailyAllowsDetls()\r\n  const { dailyallows, dailyAllowsId, setDailyAllowsId } = useDailyAllows();\r\n  const {\r\n    dailyallowsdetls,\r\n    setDailyAllowsDetlsId,\r\n    setDailyAllowsDetlsPeriod,\r\n    isLoading,\r\n  } = useDailyAllowsDetlsBatch();\r\n  const addDailyAllowsDetls = useAddDailyAllowsDetls();\r\n  const updateDailyAllowsDetls = useUpdateDailyAllowsDetls();\r\n  const deleteDailyAllowsDetls = useDeleteDailyAllowsDetls();\r\n  const updateDailyAllows = useUpdateDailyAllows();\r\n\r\n  // const [allowsDetlsTable, setAllowsDetlsTable] =\r\n  // useRecoilState(allowsDataDetlsState);\r\n  //console.log(\"detlstable\", );\r\n  //const [allowsDetlsdata, setAllowsDetilsdata] = useRecoilStateLoadable(fetchDailyAllowsDetlsSelector);\r\n  const [loginLevel, setLoginLevel] = useRecoilState(loginLevelState);\r\n  const [allowsDetlsdata, setAllowsDetlsdata] =\r\n    useRecoilState(allowsDataDetlsState);\r\n  const allows_period = useRecoilValue(allowsPeriodState);\r\n  const allows_empid = useRecoilValue(empidState);\r\n  const [siteallowsTotals, setSiteAllowsTotals] = useRecoilState(\r\n    siteallowsTotalsState\r\n  );\r\n  const [allowsdata, setAllowsdata] = useRecoilState(allowsDataState);\r\n  const [allowsdataId, setAllowsdataId] = useState(allowsDataIdState);\r\n  const [tabledeldata, setTableDelData] = useState({});\r\n  const [isCalc, setIsCalc] = useState(false);\r\n  const [isBuild, setIsBuild] = useState(false);\r\n  const [totals, setTotals] = useState({ initial_totals });\r\n  const [isSubmitAlertOpen, setIsSubmitAlertOpen] = useState(false);\r\n  const [isExitAlertOpen, setIsExitAlertOpen] = useState(false);\r\n  const [dailyallowsdata, setDailyAllowsData] = useState({});\r\n  const totalsValues = Object.values(totals).join(\"\");\r\n\r\n  // const {\r\n  //   //dailyallowances,\r\n  //   //dailyallowsdetls,\r\n  //   loadEmpDailyAllowsDetls,\r\n  //   updateDailyAllowance,\r\n  //   //updateDailyAllowsDetl,\r\n  //   //deleteDailyAllowsDetl,\r\n  //   dailyallowsdetl_loading,\r\n  //   dailyallowsdetl_error,\r\n  // } = useDailyAllowancesContext();\r\n\r\n  useEffect(() => {\r\n    setDailyAllowsId(allows_empid);\r\n    setDailyAllowsDetlsId(allows_empid);\r\n    setDailyAllowsDetlsPeriod(allows_period);\r\n    // setTimeout(() => {\r\n    //   setTotals((prevState) => ({\r\n    //     totalamount: dailyallows.amount,\r\n    //     totalbonus: dailyallows.totaljobbonus,\r\n    //     totaldiem: dailyallows.totalperdiem,\r\n    //     totaldays: dailyallows.no_of_days,\r\n    //   }));\r\n    // }, 3000);\r\n  }, [allows_empid, allows_period]);\r\n\r\n  // useEffect(() => {\r\n  //  if (allowsdata) {\r\n  //     handle_tempcalc();\r\n  //     setIsCalc(false);\r\n  //   }\r\n  // }, [isCalc]);\r\n\r\n  const handleSentEmail = (data) => {\r\n    const { period } = data;\r\n    //console.log(\"expense form\", loginLevel);\r\n    var emaildata = {\r\n      to_name: loginLevel.loginUser,\r\n      to_email: loginLevel.loginEmail,\r\n      message: `Your site allowances for the period ${period} has been successfully submitted for approval`,\r\n      cc_to: loginLevel.reporting_email,\r\n    };\r\n\r\n    emailjs.send(SERVICE_ID, TEMPLATE_ID, emaildata, USER_ID).then(\r\n      function (response) {\r\n        console.log(response.status, response.text);\r\n        toast({\r\n          title: `Email has sent successfully to ${emaildata.to_email}!`,\r\n          status: \"success\",\r\n        });\r\n      },\r\n      function (err) {\r\n        console.log(err);\r\n        toast({\r\n          title: `Email has fail to send to ${emaildata.to_email}!`,\r\n          status: \"warning\",\r\n        });\r\n      }\r\n    );\r\n  };\r\n\r\n  const build_dailyallowsdata = () => {\r\n    const { id, jobbonus, perdiem } = dailyallowsdetls;\r\n    const data = dailyallowsdetls\r\n      .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n      .map((rec) => {\r\n        return rec.id, rec.jobbonus, rec.perdiem;\r\n      });\r\n    setDailyAllowsData(data);\r\n    console.log(\"dailydata\", dailyallowsdata);\r\n  };\r\n\r\n  const update_AllowsDetls = (data, index) => {\r\n    const allowsdata = dailyallowsdetls;\r\n    const { id, rec_id, tableData, ...fields } = data;\r\n    updateDailyAllowsDetls({ id, ...fields });\r\n\r\n    //recalc\r\n    allowsdata[index].jobbonus = data.jobbonus;\r\n    allowsdata[index].perdiem = data.perdiem;\r\n    handle_tempcalc(allowsdata);\r\n    //save_siteallows();\r\n  };\r\n\r\n  const save_siteallows = () => {\r\n    const { id } = allowsdata;\r\n\r\n    updateDailyAllows({\r\n      id: id,\r\n      ...allowsdata,\r\n      no_of_days: totals.totaldays,\r\n      amount: totals.totalamount,\r\n      totaljobbonus: totals.totalbonus,\r\n      totalperdiem: totals.totaldiem,\r\n    });\r\n  };\r\n\r\n  const save_AllowsDetls = (e) => {\r\n    e.preventDefault();\r\n    // handle calc\r\n    //handle_calc();\r\n\r\n    //save allows data details\r\n    const { id } = allowsdata;\r\n\r\n    updateDailyAllows({\r\n      id: id,\r\n      ...allowsdata,\r\n      no_of_days: totals.totaldays,\r\n      amount: totals.totalamount,\r\n      totaljobbonus: totals.totalbonus,\r\n      totalperdiem: totals.totaldiem,\r\n    });\r\n    toast({\r\n      title: \"Site Allowances table being saved!\",\r\n      status: \"success\",\r\n    });\r\n  };\r\n\r\n  const submit_AllowsDetls = (e) => {\r\n    e.preventDefault();\r\n    handleSubmitAlertOpen();\r\n  };\r\n\r\n  const exit_AllowsDetls = (e) => {\r\n    e.preventDefault();\r\n    handleExitAlertOpen();\r\n  };\r\n\r\n  const handleOnSubmitConfirm = () => {\r\n    //save allows data details\r\n    const { id } = allowsdata;\r\n    updateDailyAllows({\r\n      id: id,\r\n      ...allowsdata,\r\n      no_of_days: totals.totaldays,\r\n      amount: totals.totalamount,\r\n      totaljobbonus: totals.totalbonus,\r\n      totalperdiem: totals.totaldiem,\r\n      status: \"Submitted\",\r\n    });\r\n    handleSentEmail(allowsdata);\r\n    history.push(\"/dailyallowances\");\r\n    toast({\r\n      title: \"Site Allowances table being submitted!\",\r\n      status: \"success\",\r\n    });\r\n  };\r\n\r\n  const handleOnExitConfirm = () => {\r\n    //save allows data details\r\n    const { id } = allowsdata;\r\n    updateDailyAllows({\r\n      id: id,\r\n      ...allowsdata,\r\n      no_of_days: totals.totaldays,\r\n      amount: totals.totalamount,\r\n      totaljobbonus: totals.totalbonus,\r\n      totalperdiem: totals.totaldiem,\r\n    });\r\n    history.push(\"/dailyallowances\");\r\n    toast({\r\n      title: \"Site Allowances table being submitted!\",\r\n      status: \"success\",\r\n    });\r\n  };\r\n\r\n  const handleSubmitAlertOpen = () => {\r\n    setIsSubmitAlertOpen(true);\r\n  };\r\n\r\n  const handleSubmitAlertClose = () => {\r\n    setIsSubmitAlertOpen(false);\r\n  };\r\n\r\n  const handleExitAlertOpen = () => {\r\n    setIsExitAlertOpen(true);\r\n  };\r\n\r\n  const handleExitAlertClose = () => {\r\n    setIsExitAlertOpen(false);\r\n  };\r\n\r\n  const handle_calc = () => {\r\n    if (dailyallowsdetls) {\r\n      const totbonus = dailyallowsdetls\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .reduce((acc, item) => {\r\n          if (isNaN(item.jobbonus)) {\r\n            return acc;\r\n          } else {\r\n            return acc + item.jobbonus;\r\n          }\r\n        }, 0);\r\n      const totdiem = dailyallowsdetls\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .reduce((acc, item) => {\r\n          if (isNaN(item.perdiem)) {\r\n            return acc;\r\n          } else {\r\n            return acc + item.perdiem;\r\n          }\r\n        }, 0);\r\n      const totdays = dailyallowsdetls\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .reduce((acc, item) => {\r\n          let val = 0;\r\n          if (item.jobbonus > 0 || item.perdiem > 0) {\r\n            val = 1;\r\n          } else {\r\n            val = 0;\r\n          }\r\n          return acc + val;\r\n        }, 0);\r\n      const total = totbonus + totdiem;\r\n\r\n      setTimeout(() => {\r\n        setTotals({\r\n          totalamount: total,\r\n          totalbonus: totbonus,\r\n          totaldiem: totdiem,\r\n          totaldays: totdays,\r\n        });\r\n      }, 3000);\r\n      console.log(\"calc\", totdays, totals);\r\n    }\r\n  };\r\n\r\n  const handle_tempcalc = (allowsdata) => {\r\n    if (allowsdata) {\r\n      const totbonus = allowsdata\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .reduce((acc, item) => {\r\n          if (isNaN(item.jobbonus)) {\r\n            return acc;\r\n          } else {\r\n            return acc + item.jobbonus;\r\n          }\r\n        }, 0);\r\n      const totdiem = allowsdata\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .reduce((acc, item) => {\r\n          if (isNaN(item.perdiem)) {\r\n            return acc;\r\n          } else {\r\n            return acc + item.perdiem;\r\n          }\r\n        }, 0);\r\n      const totdays = allowsdata\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .reduce((acc, item) => {\r\n          let val = 0;\r\n          if (item.jobbonus > 0 || item.perdiem > 0) {\r\n            val = 1;\r\n          } else {\r\n            val = 0;\r\n          }\r\n          return acc + val;\r\n        }, 0);\r\n      const total = totbonus + totdiem;\r\n\r\n      const data = dailyallows\r\n        .filter((r) => r.period === allows_period && r.empid === allows_empid)\r\n        .map((rec) => {\r\n          return { ...rec };\r\n        });\r\n      console.log(\"data\", data);\r\n      updateDailyAllows({\r\n        id: data[0].id,\r\n        no_of_days: totdays,\r\n        amount: total,\r\n        totaljobbonus: totbonus,\r\n        totalperdiem: totdiem,\r\n      });\r\n      // setTimeout(() => {\r\n      //   setTotals({\r\n      //     totalamount: total,\r\n      //     totalbonus: totbonus,\r\n      //     totaldiem: totdiem,\r\n      //     totaldays: totdays,\r\n      //   });\r\n      // }, 3000);\r\n      // console.log(\"tempcalc\", totdays, totals);\r\n    }\r\n  };\r\n\r\n  const update_SiteAllowsTotals = () => {\r\n    setSiteAllowsTotals({\r\n      totalamount: totals.totalamount,\r\n      totalbonus: dailyallowsdetls.reduce((acc, item) => {\r\n        if (isNaN(item.jobbonus)) {\r\n          return acc;\r\n        } else {\r\n          return acc + item.jobbonus;\r\n        }\r\n      }, 0),\r\n      totaldiem: totals.totaldiem,\r\n      totaldays: dailyallowsdetls.reduce((acc, item) => {\r\n        let val = 0;\r\n        if (item.jobbonus > 0 || item.perdiem > 0) {\r\n          val = 1;\r\n        } else {\r\n          val = 0;\r\n        }\r\n        return acc + val;\r\n      }, 0),\r\n    });\r\n    console.log(\"update\", siteallowsTotals);\r\n  };\r\n\r\n  // const add_DailyAllowsDetl = async (data) => {\r\n  //   console.log(\"add\", data);\r\n  //   const { description, amount } = data;\r\n  //   addDailyAllowsDetl({\r\n  //     description: description,\r\n  //     amount: amount,\r\n  //     name: single_dailyallowance.name,\r\n  //     empid: single_dailyallowance.empid,\r\n  //     period: dailyallowance_period,\r\n  //   });\r\n  // };\r\n\r\n  // const delete_DailyAllowance = (data) => {\r\n  //   const { id } = data;\r\n  //   deleteDailyAllowsDetl(id);\r\n  //   //update_Daily Allowances Details;\r\n  //   getSingleBatchDailyAllowsDetl(\r\n  //     single_dailyallowance.empid,\r\n  //     dailyallowance_period\r\n  //   );\r\n  // };\r\n\r\n  //  setAllowsDetlsdata(dailyallowsdetls);\r\n\r\n  // console.log(\"load allows detls\", allowsDetlsdata);\r\n  return (\r\n    <div className={classes.root}>\r\n      {/* <h1>Expenses Claims Application</h1> */}\r\n\r\n      <div style={{ maxWidth: \"75%\", paddingTop: \"5px\" }}>\r\n        {/* <h2>Site Allows Detils Table</h2> */}\r\n        <MaterialTable\r\n          columns={columns}\r\n          data={dailyallowsdetls}\r\n          title=\"Daily Allowances Details\"\r\n          editable={{\r\n            // onRowAdd: (newData) =>\r\n            //   new Promise((resolve, reject) => {\r\n            //     // setTimeout(() => {\r\n            //     //   setAllowsdata([...allowsdata, newData]);\r\n            //     //   resolve();\r\n            //     // }, 1000);\r\n            //   }),\r\n            onRowUpdate: (newData, oldData) =>\r\n              new Promise((resolve, reject) => {\r\n                setTimeout(() => {\r\n                  const dataUpdate = [...dailyallowsdetls];\r\n                  const index = oldData.tableData.id;\r\n                  dataUpdate[index] = newData;\r\n                  //setDailyAllowsData([...dataUpdate]);\r\n\r\n                  update_AllowsDetls(newData, index);\r\n                  //handle_calc();\r\n                  //setAllowsDetlsTable([...dataUpdate]);\r\n                  //editable = dataUpdate;\r\n                  resolve();\r\n                }, 1000);\r\n              }),\r\n            // onRowDelete: (oldData) =>\r\n            //   new Promise((resolve, reject) => {\r\n            //     setTimeout(() => {\r\n            //       //const dataDelete = [...allowsDetlsTable];\r\n            //       const index = oldData.tableData.id;\r\n            //       //dataDelete.splice(index, 1);\r\n            //       //setAllowsDetlsTable([...dataDelete]);\r\n\r\n            //       resolve();\r\n            //     }, 1000);\r\n            //   }),\r\n          }}\r\n          options={{\r\n            filtering: true,\r\n            selection: false,\r\n            pageSize: 10,\r\n            headerStyle: {\r\n              backgroundColor: \"orange\",\r\n              color: \"primary\",\r\n            },\r\n            showTitle: true,\r\n          }}\r\n          components={{\r\n            Toolbar: (props) => (\r\n              <div>\r\n                <MTableToolbar {...props} />\r\n                <div style={{ padding: \"5px 10px\" }}>\r\n                  {/* <Button\r\n                      type=\"submit\"\r\n                      variant=\"contained\"\r\n                      color=\"secondary\"\r\n                      className={classes.button}\r\n                      onClick={(e) => delete_AllowsDetls(e)}\r\n                    >\r\n                      delete\r\n                    </Button> */}\r\n                  {/* <Button\r\n                    type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.button}\r\n                    onClick={(e) => handle_refresh(e)}\r\n                  >\r\n                    re-fresh\r\n                  </Button> */}\r\n                  {/* <Button\r\n                    type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.button}\r\n                    onClick={(e) => handle_calc(e)}\r\n                  >\r\n                    re-calc\r\n                  </Button>\r\n                  <Button\r\n                    type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.button}\r\n                    onClick={(e) => save_AllowsDetls(e)}\r\n                  >\r\n                    Update all\r\n                  </Button> */}\r\n                  <Button\r\n                    type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.button}\r\n                    onClick={(e) => submit_AllowsDetls(e)}\r\n                  >\r\n                    Submit <Icon className={classes.rightIcon}>send</Icon>\r\n                  </Button>\r\n                  {/* <Button\r\n                    type=\"submit\"\r\n                    variant=\"contained\"\r\n                    color=\"secondary\"\r\n                    className={classes.button}\r\n                    onClick={(e) => exit_AllowsDetls(e)}\r\n                  >\r\n                    Exit\r\n                  </Button> */}\r\n\r\n                  <div>\r\n                    <Grid\r\n                      container\r\n                      spacing={0}\r\n                      direction=\"row\"\r\n                      style={{ border: \"1px solid white\" }}\r\n                    >\r\n                      <div style={{ display: \"flex\", flexDirection: \"row\" }}>\r\n                        <TextField\r\n                          label=\"Total Job Bonus\"\r\n                          variant=\"filled\"\r\n                          style={{ width: \"100%\" }}\r\n                          name=\"totalbonus\"\r\n                          value={\r\n                            dailyallows &&\r\n                            dailyallows\r\n                              .filter(\r\n                                (r) =>\r\n                                  r.period === allows_period &&\r\n                                  r.empid === allows_empid\r\n                              )\r\n                              .map((rec) => {\r\n                                return rec.totaljobbonus;\r\n                              })\r\n                          }\r\n                          type=\"currency\"\r\n                          className={classes.textField}\r\n                          InputLabelProps={{\r\n                            shrink: true,\r\n                          }}\r\n                        ></TextField>\r\n                        <TextField\r\n                          label=\"Total Diem\"\r\n                          variant=\"filled\"\r\n                          style={{ width: \"100%\" }}\r\n                          name=\"totaldiem\"\r\n                          value={\r\n                            dailyallows &&\r\n                            dailyallows\r\n                              .filter(\r\n                                (r) =>\r\n                                  r.period === allows_period &&\r\n                                  r.empid === allows_empid\r\n                              )\r\n                              .map((rec) => {\r\n                                return rec.totalperdiem;\r\n                              })\r\n                          }\r\n                          type=\"currency\"\r\n                          className={classes.textField}\r\n                          InputLabelProps={{\r\n                            shrink: true,\r\n                          }}\r\n                        ></TextField>\r\n\r\n                        <TextField\r\n                          label=\"No of Days\"\r\n                          variant=\"filled\"\r\n                          style={{ width: \"100%\" }}\r\n                          name=\"totaldays\"\r\n                          value={\r\n                            dailyallows &&\r\n                            dailyallows\r\n                              .filter(\r\n                                (r) =>\r\n                                  r.period === allows_period &&\r\n                                  r.empid === allows_empid\r\n                              )\r\n                              .map((rec) => {\r\n                                return rec.no_of_days;\r\n                              })\r\n                          }\r\n                          type=\"numeric\"\r\n                          className={classes.textField}\r\n                          InputLabelProps={{\r\n                            shrink: true,\r\n                          }}\r\n                        ></TextField>\r\n                        <TextField\r\n                          label=\"Total Amount\"\r\n                          variant=\"filled\"\r\n                          style={{ width: \"100%\" }}\r\n                          name=\"totalamount\"\r\n                          value={\r\n                            dailyallows &&\r\n                            dailyallows\r\n                              .filter(\r\n                                (r) =>\r\n                                  r.period === allows_period &&\r\n                                  r.empid === allows_empid\r\n                              )\r\n                              .map((rec) => {\r\n                                return rec.amount;\r\n                              })\r\n                          }\r\n                          type=\"currency\"\r\n                          className={classes.textField}\r\n                          InputLabelProps={{\r\n                            shrink: true,\r\n                          }}\r\n                        ></TextField>\r\n                      </div>\r\n                    </Grid>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ),\r\n          }}\r\n        />\r\n      </div>\r\n      <div>\r\n        <AlertDialogBox\r\n          onClose={handleSubmitAlertClose}\r\n          onConfirm={handleOnSubmitConfirm}\r\n          isOpen={isSubmitAlertOpen}\r\n          title=\"Site Allowances Batch\"\r\n        >\r\n          <h2>After submition for approval, no changes can be made.</h2>\r\n          <h2>Are you sure you want to submit ?</h2>\r\n        </AlertDialogBox>\r\n      </div>\r\n      <div>\r\n        <AlertDialogBox\r\n          onClose={handleExitAlertClose}\r\n          onConfirm={handleOnExitConfirm}\r\n          isOpen={isExitAlertOpen}\r\n          title=\"Site Allowances Batch\"\r\n        >\r\n          <h2>Are you sure you want to exit ?</h2>\r\n        </AlertDialogBox>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    padding: 0,\r\n    width: 1500,\r\n  },\r\n  button: {\r\n    margin: theme.spacing(1),\r\n  },\r\n}));\r\n"]},"metadata":{},"sourceType":"module"}