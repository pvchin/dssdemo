{"ast":null,"code":"import _regeneratorRuntime from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Button,ButtonGroup,TextField}from\"@material-ui/core\";import getFirebase from\"../utils/firebase\";import{makeStyles}from\"@material-ui/core/styles\";import{RecoilRoot,atom,selector,useRecoilState,useRecoilValue,useSetRecoilState}from\"recoil\";import{employees_url}from\"../utils/constants\";import{loginLevelState}from\"./data/atomdata\";import{setUserSession}from\"../helpers/storageHelper\";import{useEmployeesContext}from\"../context/employees_context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SigninForm=function SigninForm(_ref){var role=_ref.role,setRole=_ref.setRole,currentUser=_ref.currentUser,setCurrentUser=_ref.setCurrentUser;var classes=useStyles();var firebaseInstance=getFirebase();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),alert=_useState6[0],setAlert=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),access=_useState8[0],setAccess=_useState8[1];//const [currentUser, setCurrentUser] = useState(\"\");\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isLoading=_useState10[0],setIsLoading=_useState10[1];var _useRecoilState=useRecoilState(loginLevelState),_useRecoilState2=_slicedToArray(_useRecoilState,2),loginLevel=_useRecoilState2[0],setLoginLevel=_useRecoilState2[1];var _useEmployeesContext=useEmployeesContext(),employees=_useEmployeesContext.employees,single_employee=_useEmployeesContext.single_employee,loadEmployees=_useEmployeesContext.loadEmployees,employees_loading=_useEmployeesContext.employees_loading,employees_error=_useEmployeesContext.employees_error,single_employee_loading=_useEmployeesContext.single_employee_loading,single_employee_error=_useEmployeesContext.single_employee_error,getSingleEmployeeEmail=_useEmployeesContext.getSingleEmployeeEmail,setEditEmployeeID=_useEmployeesContext.setEditEmployeeID;// useEffect(() => {\n//   console.log(\"getsingleemployee\", email);\n//   getSingleEmployeeEmail(email);\n//   if (email && single_employee) {\n//     console.log(\"done\", email, single_employee);\n//     setIsLoading(false);\n//   }\n// }, [isLoading]);\n// const handleSubmit = (e) => {\n//   e.preventDefault();\n//   const emp = employees\n//     .filter((item) => item.email === email)\n//     .map((row) => {\n//       return {\n//         id: row.id,\n//         name: row.name,\n//         email: row.email,\n//         password: row.password,\n//         leave_bal: row.leave_bal,\n//         siteallows_fee: row.siteallows_fee,\n//         perdiem_fee: row.perdiem_fee,\n//         reporting_to: row.reporting_to,\n//       };\n//     });\n//   if (emp[0].email === email && emp[0].password === password) {\n//     setLoginLevel({\n//       ...loginLevel,\n//       loginUser: emp[0].name,\n//       loginUserId: emp[0].id,\n//       loginLevel: role,\n//       loginEmail: email,\n//       login: true,\n//       leave_bal: emp[0].leave_bal,\n//       siteallows_fee: emp[0].siteallows_fee,\n//       perdiem_fee: emp[0].perdiem_fee,\n//       reporting_to: emp[0].reporting_to,\n//     });\n//     setEditEmployeeID(emp[0].id);\n//     setPassword(\"\");\n//   } else {\n//     setAlert(false);\n//   }\n// };\nuseEffect(function(){loadEmployees();},[]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var user,emp,lAccess,SwitchCase;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();console.log(\"role\",role);_context.prev=2;if(!firebaseInstance){_context.next=14;break;}_context.next=6;return firebaseInstance.auth().signInWithEmailAndPassword(email,password);case 6:user=_context.sent;console.log(\"user\",user);setCurrentUser(email);emp=employees.filter(function(item){return item.email===email;}).map(function(row){return{id:row.id,name:row.name,email:row.email,leave_bal:row.leave_bal,siteallows_fee:row.siteallows_fee,perdiem_fee:row.perdiem_fee,reporting_to:row.reporting_to,role:row.role};});console.log(\"emp\",emp,user.email);lAccess=false;SwitchCase=function SwitchCase(){switch(role){case\"Staff\":lAccess=true;// eslint-disable-next-line no-fallthrough\ncase\"Admin\":if(emp[0].role>1){lAccess=true;}else{lAccess=false;}// eslint-disable-next-line no-fallthrough\ncase\"AdminManager\":if(emp[0].role>2){lAccess=true;}else{lAccess=false;}// eslint-disable-next-line no-fallthrough\ncase\"Manager\":if(emp[0].role>3){lAccess=true;}else{lAccess=false;}// eslint-disable-next-line no-fallthrough\ndefault:lAccess=false;}};if(lAccess=false){setAccess(false);setTimeout(function(){setAccess(true);},3000);}else{setLoginLevel(_objectSpread(_objectSpread({},loginLevel),{},{loginUser:emp[0].name,loginUserId:emp[0].id,loginLevel:role,loginEmail:email,login:true,leave_bal:emp[0].leave_bal,siteallows_fee:emp[0].siteallows_fee,perdiem_fee:emp[0].perdiem_fee,reporting_to:emp[0].reporting_to,role:emp[0].role}));setEditEmployeeID(emp[0].id);// setUserSession(role, loginLevel);\n}case 14:console.log(\"Signin\",loginLevel);_context.next=22;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](2);console.log(\"error\",_context.t0);setAlert(true);setTimeout(function(){setAlert(false);},3000);case 22:case\"end\":return _context.stop();}}},_callee,null,[[2,17]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleStaffClick=function handleStaffClick(e){e.preventDefault();setRole(\"Staff\");handleSubmit(e);};var handleAdminClick=function handleAdminClick(e){e.preventDefault();var lvl=employees.filter(function(i){return i.email===email;});console.log(\"level\",lvl);if(lvl[0].role>1){setRole(\"Admin\");handleSubmit(e);}else{setAccess(false);setTimeout(function(){setAccess(true);},3000);}};var handleAdminManagerClick=function handleAdminManagerClick(e){e.preventDefault();var lvl=employees.filter(function(i){return i.email===email;});console.log(loginLevel.role);if(lvl[0].role>2){setRole(\"AdminManager\");handleSubmit(e);}else{setAccess(false);setTimeout(function(){setAccess(true);},3000);}};var handleManagerClick=function handleManagerClick(e){e.preventDefault();if(loginLevel.role>3){setRole(\"Manager\");handleSubmit(e);}else{setAccess(false);setTimeout(function(){setAccess(true);},3000);}};if(employees_loading){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})});}if(employees_error){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Internet connection problem!\"})});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"form\",{className:classes.root,onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(TextField,{label:\"Email\",variant:\"filled\",type:\"email\",required:true,style:{width:350},value:email,onChange:function onChange(e){return setEmail(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{label:\"Password\",variant:\"filled\",type:\"password\",style:{width:350},required:true,value:password,onChange:function onChange(e){return setPassword(e.target.value);}}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",className:classes.button,onClick:function onClick(e){return setRole(\"Staff\");},children:\"Staff\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",className:classes.button,onClick:function onClick(e){return setRole(\"Admin\");},children:\"Admin\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",className:classes.button,onClick:function onClick(e){return setRole(\"AdminManager\");},children:\"Admin Manager\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",className:classes.button,onClick:function onClick(e){return setRole(\"Manager\");},children:\"Manager\"})]})}),alert&&/*#__PURE__*/_jsx(\"h3\",{children:\"Login Fail!\"}),!access&&/*#__PURE__*/_jsx(\"h3\",{children:\"No authorised Access!\"})]})});};var useStyles=makeStyles(function(theme){return{root:{display:\"flex\",flexDirection:\"column\",justifyContent:\"center\",alignItems:\"center\",padding:theme.spacing(2),\"& .MuiTextField-root\":{margin:theme.spacing(1),width:\"600px\"},\"& .MuiButtonBase-root\":{margin:theme.spacing(2)}}};});export default SigninForm;","map":{"version":3,"sources":["D:/react-myprojects/hrms-airtable/src/components/SigninForm.js"],"names":["React","useState","useEffect","Button","ButtonGroup","TextField","getFirebase","makeStyles","RecoilRoot","atom","selector","useRecoilState","useRecoilValue","useSetRecoilState","employees_url","loginLevelState","setUserSession","useEmployeesContext","SigninForm","role","setRole","currentUser","setCurrentUser","classes","useStyles","firebaseInstance","email","setEmail","password","setPassword","alert","setAlert","access","setAccess","isLoading","setIsLoading","loginLevel","setLoginLevel","employees","single_employee","loadEmployees","employees_loading","employees_error","single_employee_loading","single_employee_error","getSingleEmployeeEmail","setEditEmployeeID","handleSubmit","e","preventDefault","console","log","auth","signInWithEmailAndPassword","user","emp","filter","item","map","row","id","name","leave_bal","siteallows_fee","perdiem_fee","reporting_to","lAccess","SwitchCase","setTimeout","loginUser","loginUserId","loginEmail","login","handleStaffClick","handleAdminClick","lvl","i","handleAdminManagerClick","handleManagerClick","root","width","target","value","textAlign","button","theme","display","flexDirection","justifyContent","alignItems","padding","spacing","margin"],"mappings":"4lBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,MAAT,CAAiBC,WAAjB,CAA8BC,SAA9B,KAA+C,mBAA/C,CACA,MAAOC,CAAAA,WAAP,KAAwB,mBAAxB,CACA,OAASC,UAAT,KAA2B,0BAA3B,CACA,OACEC,UADF,CAEEC,IAFF,CAGEC,QAHF,CAIEC,cAJF,CAKEC,cALF,CAMEC,iBANF,KAOO,QAPP,CAQA,OAASC,aAAT,KAA8B,oBAA9B,CACA,OAASC,eAAT,KAAgC,iBAAhC,CACA,OAASC,cAAT,KAA+B,0BAA/B,CACA,OAASC,mBAAT,KAAoC,8BAApC,C,6IAEA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,MAAoD,IAAjDC,CAAAA,IAAiD,MAAjDA,IAAiD,CAA3CC,OAA2C,MAA3CA,OAA2C,CAAlCC,WAAkC,MAAlCA,WAAkC,CAArBC,cAAqB,MAArBA,cAAqB,CACrE,GAAMC,CAAAA,OAAO,CAAGC,SAAS,EAAzB,CACA,GAAMC,CAAAA,gBAAgB,CAAGnB,WAAW,EAApC,CAFqE,cAG3CL,QAAQ,CAAC,EAAD,CAHmC,wCAG9DyB,KAH8D,eAGvDC,QAHuD,8BAIrC1B,QAAQ,CAAC,EAAD,CAJ6B,yCAI9D2B,QAJ8D,eAIpDC,WAJoD,8BAK3C5B,QAAQ,CAAC,KAAD,CALmC,yCAK9D6B,KAL8D,eAKvDC,QALuD,8BAMzC9B,QAAQ,CAAC,IAAD,CANiC,yCAM9D+B,MAN8D,eAMtDC,SANsD,eAOrE;AAPqE,eAQnChC,QAAQ,CAAC,KAAD,CAR2B,0CAQ9DiC,SAR8D,gBAQnDC,YARmD,oCASjCxB,cAAc,CAACI,eAAD,CATmB,oDAS9DqB,UAT8D,qBASlDC,aATkD,8CAoBjEpB,mBAAmB,EApB8C,CAWnEqB,SAXmE,sBAWnEA,SAXmE,CAYnEC,eAZmE,sBAYnEA,eAZmE,CAanEC,aAbmE,sBAanEA,aAbmE,CAcnEC,iBAdmE,sBAcnEA,iBAdmE,CAenEC,eAfmE,sBAenEA,eAfmE,CAgBnEC,uBAhBmE,sBAgBnEA,uBAhBmE,CAiBnEC,qBAjBmE,sBAiBnEA,qBAjBmE,CAkBnEC,sBAlBmE,sBAkBnEA,sBAlBmE,CAmBnEC,iBAnBmE,sBAmBnEA,iBAnBmE,CAsBrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA5C,SAAS,CAAC,UAAM,CACdsC,aAAa,GACd,CAFQ,CAEN,EAFM,CAAT,CAIA,GAAMO,CAAAA,YAAY,2FAAG,iBAAOC,CAAP,kJACnBA,CAAC,CAACC,cAAF,GACAC,OAAO,CAACC,GAAR,CAAY,MAAZ,CAAoBhC,IAApB,EAFmB,oBAIbM,gBAJa,gDAKIA,CAAAA,gBAAgB,CAChC2B,IADgB,GAEhBC,0BAFgB,CAEW3B,KAFX,CAEkBE,QAFlB,CALJ,QAKT0B,IALS,eASfJ,OAAO,CAACC,GAAR,CAAY,MAAZ,CAAoBG,IAApB,EACAhC,cAAc,CAACI,KAAD,CAAd,CACM6B,GAXS,CAWHjB,SAAS,CAClBkB,MADS,CACF,SAACC,IAAD,QAAUA,CAAAA,IAAI,CAAC/B,KAAL,GAAeA,KAAzB,EADE,EAETgC,GAFS,CAEL,SAACC,GAAD,CAAS,CACZ,MAAO,CACLC,EAAE,CAAED,GAAG,CAACC,EADH,CAELC,IAAI,CAAEF,GAAG,CAACE,IAFL,CAGLnC,KAAK,CAAEiC,GAAG,CAACjC,KAHN,CAILoC,SAAS,CAAEH,GAAG,CAACG,SAJV,CAKLC,cAAc,CAAEJ,GAAG,CAACI,cALf,CAMLC,WAAW,CAAEL,GAAG,CAACK,WANZ,CAOLC,YAAY,CAAEN,GAAG,CAACM,YAPb,CAQL9C,IAAI,CAAEwC,GAAG,CAACxC,IARL,CAAP,CAUD,CAbS,CAXG,CAyBf+B,OAAO,CAACC,GAAR,CAAY,KAAZ,CAAmBI,GAAnB,CAAwBD,IAAI,CAAC5B,KAA7B,EACIwC,OA1BW,CA0BD,KA1BC,CA2BTC,UA3BS,CA2BI,QAAbA,CAAAA,UAAa,EAAM,CACvB,OAAQhD,IAAR,EACE,IAAK,OAAL,CACE+C,OAAO,CAAG,IAAV,CACF;AACA,IAAK,OAAL,CACE,GAAIX,GAAG,CAAC,CAAD,CAAH,CAAOpC,IAAP,CAAc,CAAlB,CAAqB,CACnB+C,OAAO,CAAG,IAAV,CACD,CAFD,IAEO,CACLA,OAAO,CAAG,KAAV,CACD,CACH;AACA,IAAK,cAAL,CACE,GAAIX,GAAG,CAAC,CAAD,CAAH,CAAOpC,IAAP,CAAc,CAAlB,CAAqB,CACnB+C,OAAO,CAAG,IAAV,CACD,CAFD,IAEO,CACLA,OAAO,CAAG,KAAV,CACD,CACH;AACA,IAAK,SAAL,CACE,GAAIX,GAAG,CAAC,CAAD,CAAH,CAAOpC,IAAP,CAAc,CAAlB,CAAqB,CACnB+C,OAAO,CAAG,IAAV,CACD,CAFD,IAEO,CACLA,OAAO,CAAG,KAAV,CACD,CACH;AACA,QACEA,OAAO,CAAG,KAAV,CA1BJ,CA4BD,CAxDc,CAyDf,GAAKA,OAAO,CAAG,KAAf,CAAuB,CACrBjC,SAAS,CAAC,KAAD,CAAT,CACAmC,UAAU,CAAC,UAAM,CACfnC,SAAS,CAAC,IAAD,CAAT,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CALD,IAKO,CACLI,aAAa,gCACRD,UADQ,MAEXiC,SAAS,CAAEd,GAAG,CAAC,CAAD,CAAH,CAAOM,IAFP,CAGXS,WAAW,CAAEf,GAAG,CAAC,CAAD,CAAH,CAAOK,EAHT,CAIXxB,UAAU,CAAEjB,IAJD,CAKXoD,UAAU,CAAE7C,KALD,CAMX8C,KAAK,CAAE,IANI,CAOXV,SAAS,CAAEP,GAAG,CAAC,CAAD,CAAH,CAAOO,SAPP,CAQXC,cAAc,CAAER,GAAG,CAAC,CAAD,CAAH,CAAOQ,cARZ,CASXC,WAAW,CAAET,GAAG,CAAC,CAAD,CAAH,CAAOS,WATT,CAUXC,YAAY,CAAEV,GAAG,CAAC,CAAD,CAAH,CAAOU,YAVV,CAWX9C,IAAI,CAAEoC,GAAG,CAAC,CAAD,CAAH,CAAOpC,IAXF,GAAb,CAaA2B,iBAAiB,CAACS,GAAG,CAAC,CAAD,CAAH,CAAOK,EAAR,CAAjB,CACA;AACD,CA9Ec,QAgFjBV,OAAO,CAACC,GAAR,CAAY,QAAZ,CAAsBf,UAAtB,EAhFiB,iFAkFjBc,OAAO,CAACC,GAAR,CAAY,OAAZ,cACApB,QAAQ,CAAC,IAAD,CAAR,CACAqC,UAAU,CAAC,UAAM,CACfrC,QAAQ,CAAC,KAAD,CAAR,CACD,CAFS,CAEP,IAFO,CAAV,CApFiB,qEAAH,kBAAZgB,CAAAA,YAAY,6CAAlB,CA0FA,GAAM0B,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACzB,CAAD,CAAO,CAC9BA,CAAC,CAACC,cAAF,GACA7B,OAAO,CAAC,OAAD,CAAP,CACA2B,YAAY,CAACC,CAAD,CAAZ,CACD,CAJD,CAKA,GAAM0B,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAAC1B,CAAD,CAAO,CAC9BA,CAAC,CAACC,cAAF,GACA,GAAM0B,CAAAA,GAAG,CAAGrC,SAAS,CAACkB,MAAV,CAAiB,SAACoB,CAAD,QAAOA,CAAAA,CAAC,CAAClD,KAAF,GAAYA,KAAnB,EAAjB,CAAZ,CACAwB,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAqBwB,GAArB,EACA,GAAIA,GAAG,CAAC,CAAD,CAAH,CAAOxD,IAAP,CAAc,CAAlB,CAAqB,CACnBC,OAAO,CAAC,OAAD,CAAP,CACA2B,YAAY,CAACC,CAAD,CAAZ,CACD,CAHD,IAGO,CACLf,SAAS,CAAC,KAAD,CAAT,CACAmC,UAAU,CAAC,UAAM,CACfnC,SAAS,CAAC,IAAD,CAAT,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CACF,CAbD,CAcA,GAAM4C,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,CAAC7B,CAAD,CAAO,CACrCA,CAAC,CAACC,cAAF,GACA,GAAM0B,CAAAA,GAAG,CAAGrC,SAAS,CAACkB,MAAV,CAAiB,SAACoB,CAAD,QAAOA,CAAAA,CAAC,CAAClD,KAAF,GAAYA,KAAnB,EAAjB,CAAZ,CACAwB,OAAO,CAACC,GAAR,CAAYf,UAAU,CAACjB,IAAvB,EACA,GAAIwD,GAAG,CAAC,CAAD,CAAH,CAAOxD,IAAP,CAAc,CAAlB,CAAqB,CACnBC,OAAO,CAAC,cAAD,CAAP,CACA2B,YAAY,CAACC,CAAD,CAAZ,CACD,CAHD,IAGO,CACLf,SAAS,CAAC,KAAD,CAAT,CACAmC,UAAU,CAAC,UAAM,CACfnC,SAAS,CAAC,IAAD,CAAT,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CACF,CAbD,CAcA,GAAM6C,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAAC9B,CAAD,CAAO,CAChCA,CAAC,CAACC,cAAF,GAEA,GAAIb,UAAU,CAACjB,IAAX,CAAkB,CAAtB,CAAyB,CACvBC,OAAO,CAAC,SAAD,CAAP,CACA2B,YAAY,CAACC,CAAD,CAAZ,CACD,CAHD,IAGO,CACLf,SAAS,CAAC,KAAD,CAAT,CACAmC,UAAU,CAAC,UAAM,CACfnC,SAAS,CAAC,IAAD,CAAT,CACD,CAFS,CAEP,IAFO,CAAV,CAGD,CACF,CAZD,CAcA,GAAIQ,iBAAJ,CAAuB,CACrB,mBACE,kCACE,kCADF,EADF,CAKD,CACD,GAAIC,eAAJ,CAAqB,CACnB,mBACE,kCACE,oDADF,EADF,CAKD,CAED,mBACE,sCACE,cAAM,SAAS,CAAEnB,OAAO,CAACwD,IAAzB,CAA+B,QAAQ,CAAEhC,YAAzC,wBACE,KAAC,SAAD,EACE,KAAK,CAAC,OADR,CAEE,OAAO,CAAC,QAFV,CAGE,IAAI,CAAC,OAHP,CAIE,QAAQ,KAJV,CAKE,KAAK,CAAE,CAAEiC,KAAK,CAAE,GAAT,CALT,CAME,KAAK,CAAEtD,KANT,CAOE,QAAQ,CAAE,kBAACsB,CAAD,QAAOrB,CAAAA,QAAQ,CAACqB,CAAC,CAACiC,MAAF,CAASC,KAAV,CAAf,EAPZ,EADF,cAUE,KAAC,SAAD,EACE,KAAK,CAAC,UADR,CAEE,OAAO,CAAC,QAFV,CAGE,IAAI,CAAC,UAHP,CAIE,KAAK,CAAE,CAAEF,KAAK,CAAE,GAAT,CAJT,CAKE,QAAQ,KALV,CAME,KAAK,CAAEpD,QANT,CAOE,QAAQ,CAAE,kBAACoB,CAAD,QAAOnB,CAAAA,WAAW,CAACmB,CAAC,CAACiC,MAAF,CAASC,KAAV,CAAlB,EAPZ,EAVF,cAmBE,YAAK,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAb,CAAZ,uBACE,MAAC,WAAD,yBACE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAC,WAFV,CAGE,KAAK,CAAC,SAHR,CAIE,SAAS,CAAE5D,OAAO,CAAC6D,MAJrB,CAKE,OAAO,CAAE,iBAACpC,CAAD,QAAO5B,CAAAA,OAAO,CAAC,OAAD,CAAd,EALX,mBADF,cAWE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAC,WAFV,CAGE,KAAK,CAAC,SAHR,CAIE,SAAS,CAAEG,OAAO,CAAC6D,MAJrB,CAKE,OAAO,CAAE,iBAACpC,CAAD,QAAO5B,CAAAA,OAAO,CAAC,OAAD,CAAd,EALX,mBAXF,cAqBE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAC,WAFV,CAGE,KAAK,CAAC,SAHR,CAIE,SAAS,CAAEG,OAAO,CAAC6D,MAJrB,CAKE,OAAO,CAAE,iBAACpC,CAAD,QAAO5B,CAAAA,OAAO,CAAC,cAAD,CAAd,EALX,2BArBF,cA+BE,KAAC,MAAD,EACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAC,WAFV,CAGE,KAAK,CAAC,SAHR,CAIE,SAAS,CAAEG,OAAO,CAAC6D,MAJrB,CAKE,OAAO,CAAE,iBAACpC,CAAD,QAAO5B,CAAAA,OAAO,CAAC,SAAD,CAAd,EALX,qBA/BF,GADF,EAnBF,CA8DGU,KAAK,eAAI,mCA9DZ,CA+DG,CAACE,MAAD,eAAW,6CA/Dd,GADF,EADF,CAqED,CAtSD,CAwSA,GAAMR,CAAAA,SAAS,CAAGjB,UAAU,CAAC,SAAC8E,KAAD,QAAY,CACvCN,IAAI,CAAE,CACJO,OAAO,CAAE,MADL,CAEJC,aAAa,CAAE,QAFX,CAGJC,cAAc,CAAE,QAHZ,CAIJC,UAAU,CAAE,QAJR,CAKJC,OAAO,CAAEL,KAAK,CAACM,OAAN,CAAc,CAAd,CALL,CAOJ,uBAAwB,CACtBC,MAAM,CAAEP,KAAK,CAACM,OAAN,CAAc,CAAd,CADc,CAEtBX,KAAK,CAAE,OAFe,CAPpB,CAWJ,wBAAyB,CACvBY,MAAM,CAAEP,KAAK,CAACM,OAAN,CAAc,CAAd,CADe,CAXrB,CADiC,CAAZ,EAAD,CAA5B,CAkBA,cAAezE,CAAAA,UAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Button, ButtonGroup, TextField } from \"@material-ui/core\";\r\nimport getFirebase from \"../utils/firebase\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport {\r\n  RecoilRoot,\r\n  atom,\r\n  selector,\r\n  useRecoilState,\r\n  useRecoilValue,\r\n  useSetRecoilState,\r\n} from \"recoil\";\r\nimport { employees_url } from \"../utils/constants\";\r\nimport { loginLevelState } from \"./data/atomdata\";\r\nimport { setUserSession } from \"../helpers/storageHelper\";\r\nimport { useEmployeesContext } from \"../context/employees_context\";\r\n\r\nconst SigninForm = ({ role, setRole, currentUser, setCurrentUser }) => {\r\n  const classes = useStyles();\r\n  const firebaseInstance = getFirebase();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [alert, setAlert] = useState(false);\r\n  const [access, setAccess] = useState(true);\r\n  //const [currentUser, setCurrentUser] = useState(\"\");\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [loginLevel, setLoginLevel] = useRecoilState(loginLevelState);\r\n  const {\r\n    employees,\r\n    single_employee,\r\n    loadEmployees,\r\n    employees_loading,\r\n    employees_error,\r\n    single_employee_loading,\r\n    single_employee_error,\r\n    getSingleEmployeeEmail,\r\n    setEditEmployeeID,\r\n  } = useEmployeesContext();\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"getsingleemployee\", email);\r\n  //   getSingleEmployeeEmail(email);\r\n  //   if (email && single_employee) {\r\n  //     console.log(\"done\", email, single_employee);\r\n  //     setIsLoading(false);\r\n  //   }\r\n  // }, [isLoading]);\r\n\r\n  // const handleSubmit = (e) => {\r\n  //   e.preventDefault();\r\n\r\n  //   const emp = employees\r\n  //     .filter((item) => item.email === email)\r\n  //     .map((row) => {\r\n  //       return {\r\n  //         id: row.id,\r\n  //         name: row.name,\r\n  //         email: row.email,\r\n  //         password: row.password,\r\n  //         leave_bal: row.leave_bal,\r\n  //         siteallows_fee: row.siteallows_fee,\r\n  //         perdiem_fee: row.perdiem_fee,\r\n  //         reporting_to: row.reporting_to,\r\n  //       };\r\n  //     });\r\n\r\n  //   if (emp[0].email === email && emp[0].password === password) {\r\n  //     setLoginLevel({\r\n  //       ...loginLevel,\r\n  //       loginUser: emp[0].name,\r\n  //       loginUserId: emp[0].id,\r\n  //       loginLevel: role,\r\n  //       loginEmail: email,\r\n  //       login: true,\r\n  //       leave_bal: emp[0].leave_bal,\r\n  //       siteallows_fee: emp[0].siteallows_fee,\r\n  //       perdiem_fee: emp[0].perdiem_fee,\r\n  //       reporting_to: emp[0].reporting_to,\r\n  //     });\r\n  //     setEditEmployeeID(emp[0].id);\r\n  //     setPassword(\"\");\r\n  //   } else {\r\n  //     setAlert(false);\r\n  //   }\r\n  // };\r\n\r\n  useEffect(() => {\r\n    loadEmployees();\r\n  }, []);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    console.log(\"role\", role);\r\n    try {\r\n      if (firebaseInstance) {\r\n        const user = await firebaseInstance\r\n          .auth()\r\n          .signInWithEmailAndPassword(email, password);\r\n\r\n        console.log(\"user\", user);\r\n        setCurrentUser(email);\r\n        const emp = employees\r\n          .filter((item) => item.email === email)\r\n          .map((row) => {\r\n            return {\r\n              id: row.id,\r\n              name: row.name,\r\n              email: row.email,\r\n              leave_bal: row.leave_bal,\r\n              siteallows_fee: row.siteallows_fee,\r\n              perdiem_fee: row.perdiem_fee,\r\n              reporting_to: row.reporting_to,\r\n              role: row.role,\r\n            };\r\n          });\r\n        console.log(\"emp\", emp, user.email);\r\n        let lAccess = false;\r\n        const SwitchCase = () => {\r\n          switch (role) {\r\n            case \"Staff\":\r\n              lAccess = true;\r\n            // eslint-disable-next-line no-fallthrough\r\n            case \"Admin\":\r\n              if (emp[0].role > 1) {\r\n                lAccess = true;\r\n              } else {\r\n                lAccess = false;\r\n              }\r\n            // eslint-disable-next-line no-fallthrough\r\n            case \"AdminManager\":\r\n              if (emp[0].role > 2) {\r\n                lAccess = true;\r\n              } else {\r\n                lAccess = false;\r\n              }\r\n            // eslint-disable-next-line no-fallthrough\r\n            case \"Manager\":\r\n              if (emp[0].role > 3) {\r\n                lAccess = true;\r\n              } else {\r\n                lAccess = false;\r\n              }\r\n            // eslint-disable-next-line no-fallthrough\r\n            default:\r\n              lAccess = false;\r\n          }\r\n        };\r\n        if ((lAccess = false)) {\r\n          setAccess(false);\r\n          setTimeout(() => {\r\n            setAccess(true);\r\n          }, 3000);\r\n        } else {\r\n          setLoginLevel({\r\n            ...loginLevel,\r\n            loginUser: emp[0].name,\r\n            loginUserId: emp[0].id,\r\n            loginLevel: role,\r\n            loginEmail: email,\r\n            login: true,\r\n            leave_bal: emp[0].leave_bal,\r\n            siteallows_fee: emp[0].siteallows_fee,\r\n            perdiem_fee: emp[0].perdiem_fee,\r\n            reporting_to: emp[0].reporting_to,\r\n            role: emp[0].role,\r\n          });\r\n          setEditEmployeeID(emp[0].id);\r\n          // setUserSession(role, loginLevel);\r\n        }\r\n      }\r\n      console.log(\"Signin\", loginLevel);\r\n    } catch (error) {\r\n      console.log(\"error\", error);\r\n      setAlert(true);\r\n      setTimeout(() => {\r\n        setAlert(false);\r\n      }, 3000);\r\n    }\r\n  };\r\n\r\n  const handleStaffClick = (e) => {\r\n    e.preventDefault();\r\n    setRole(\"Staff\");\r\n    handleSubmit(e);\r\n  };\r\n  const handleAdminClick = (e) => {\r\n    e.preventDefault();\r\n    const lvl = employees.filter((i) => i.email === email);\r\n    console.log(\"level\", lvl);\r\n    if (lvl[0].role > 1) {\r\n      setRole(\"Admin\");\r\n      handleSubmit(e);\r\n    } else {\r\n      setAccess(false);\r\n      setTimeout(() => {\r\n        setAccess(true);\r\n      }, 3000);\r\n    }\r\n  };\r\n  const handleAdminManagerClick = (e) => {\r\n    e.preventDefault();\r\n    const lvl = employees.filter((i) => i.email === email);\r\n    console.log(loginLevel.role);\r\n    if (lvl[0].role > 2) {\r\n      setRole(\"AdminManager\");\r\n      handleSubmit(e);\r\n    } else {\r\n      setAccess(false);\r\n      setTimeout(() => {\r\n        setAccess(true);\r\n      }, 3000);\r\n    }\r\n  };\r\n  const handleManagerClick = (e) => {\r\n    e.preventDefault();\r\n\r\n    if (loginLevel.role > 3) {\r\n      setRole(\"Manager\");\r\n      handleSubmit(e);\r\n    } else {\r\n      setAccess(false);\r\n      setTimeout(() => {\r\n        setAccess(true);\r\n      }, 3000);\r\n    }\r\n  };\r\n\r\n  if (employees_loading) {\r\n    return (\r\n      <div>\r\n        <h2>Loading...</h2>\r\n      </div>\r\n    );\r\n  }\r\n  if (employees_error) {\r\n    return (\r\n      <div>\r\n        <h2>Internet connection problem!</h2>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <form className={classes.root} onSubmit={handleSubmit}>\r\n        <TextField\r\n          label=\"Email\"\r\n          variant=\"filled\"\r\n          type=\"email\"\r\n          required\r\n          style={{ width: 350 }}\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n        />\r\n        <TextField\r\n          label=\"Password\"\r\n          variant=\"filled\"\r\n          type=\"password\"\r\n          style={{ width: 350 }}\r\n          required\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n        />\r\n        <div style={{ textAlign: \"center\" }}>\r\n          <ButtonGroup>\r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"contained\"\r\n              color=\"primary\"\r\n              className={classes.button}\r\n              onClick={(e) => setRole(\"Staff\")}\r\n            >\r\n              Staff\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"contained\"\r\n              color=\"primary\"\r\n              className={classes.button}\r\n              onClick={(e) => setRole(\"Admin\")}\r\n            >\r\n              Admin\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"contained\"\r\n              color=\"primary\"\r\n              className={classes.button}\r\n              onClick={(e) => setRole(\"AdminManager\")}\r\n            >\r\n              Admin Manager\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"contained\"\r\n              color=\"primary\"\r\n              className={classes.button}\r\n              onClick={(e) => setRole(\"Manager\")}\r\n            >\r\n              Manager\r\n            </Button>\r\n          </ButtonGroup>\r\n        </div>\r\n        {alert && <h3>Login Fail!</h3>}\r\n        {!access && <h3>No authorised Access!</h3>}\r\n      </form>\r\n    </>\r\n  );\r\n};\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    padding: theme.spacing(2),\r\n\r\n    \"& .MuiTextField-root\": {\r\n      margin: theme.spacing(1),\r\n      width: \"600px\",\r\n    },\r\n    \"& .MuiButtonBase-root\": {\r\n      margin: theme.spacing(2),\r\n    },\r\n  },\r\n}));\r\n\r\nexport default SigninForm;\r\n"]},"metadata":{},"sourceType":"module"}