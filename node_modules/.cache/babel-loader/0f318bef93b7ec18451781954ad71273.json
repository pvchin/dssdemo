{"ast":null,"code":"import _objectSpread from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/react-myprojects/hrms-airtable/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";//import { useHistory } from \"react-router-dom\";\n//import { Button, TextField } from \"@material-ui/core\";\nimport{AspectRatio,Box,Button,Container,Divider,Flex,FormControl,Heading,Image,Input,InputGroup,InputLeftAddon,Stack,HStack,VStack,Wrap}from\"@chakra-ui/react\";import{makeStyles}from\"@material-ui/core/styles\";import{Controller,useForm}from\"react-hook-form\";import{useCustomToast}from\"../helpers/useCustomToast\";import{useEmployees}from\"./employees/useEmployees\";import{useRecoilState}from\"recoil\";import{loginLevelState}from\"./data/atomdata\";import{useEmployeesContext}from\"../context/employees_context\";//import { setStoredUser } from \"./user-storage\";\n//import { useAuthContext } from \"../context/auth_context\";\nimport img from\"../assets/AppSutLogo.jpg\";import App from\"../utils/firebase\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initial_values={email:\"\",password:\"\"};var SigninForm=function SigninForm(){//let history = useHistory();\nvar classes=useStyles();var toast=useCustomToast();var field_width=\"40\";//const { currentUser } = useAuthContext();\nvar _useEmployees=useEmployees(),employees=_useEmployees.employees;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),role=_useState6[0],setRole=_useState6[1];var _useState7=useState(initial_values),_useState8=_slicedToArray(_useState7,2),state=_useState8[0],setState=_useState8[1];var _useRecoilState=useRecoilState(loginLevelState),_useRecoilState2=_slicedToArray(_useRecoilState,2),loginLevel=_useRecoilState2[0],setLoginLevel=_useRecoilState2[1];var _useEmployeesContext=useEmployeesContext(),setEditEmployeeID=_useEmployeesContext.setEditEmployeeID;var _useForm=useForm({defaultValues:state}),handleSubmit=_useForm.handleSubmit,control=_useForm.control,register=_useForm.register,reset=_useForm.reset,_useForm$formState=_useForm.formState,errors=_useForm$formState.errors,isSubmitting=_useForm$formState.isSubmitting;var handleLogin=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var email,password;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://event.preventDefault();\n//console.log(\"sigin\", values);\nemail=values.email,password=values.password;_context.prev=1;_context.next=4;return App.auth().signInWithEmailAndPassword(email,password);case 4://history.pushState(\"/\");\nupdate_login();_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);toast({title:\"Invalid email or password!\",status:\"warning\"});case 10:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function handleLogin(_x){return _ref.apply(this,arguments);};}();var update_login=function update_login(){var emp=employees.filter(function(item){return item.email===email;}).map(function(row){return{id:row.id,name:row.name,email:row.email,password:row.password,role:role,level:row.role,leave_bal:row.leave_bal,siteallows_fee:row.siteallows_fee,perdiem_fee:row.perdiem_fee,reporting_to:row.reporting_to,reporting_email:row.reporting_email};});if(email===\"admin@abc.com\"){//setRole(role);\nsetRole(\"Staff\");setLoginLevel(_objectSpread(_objectSpread({},loginLevel),{},{loginUser:\"Admin\",loginUserId:\"admin\",loginLevel:\"Staff\",loginEmail:\"admin@abc.com\",login:true,leave_bal:0,siteallows_fee:0,perdiem_fee:0,reporting_to:\"\",reporting_email:\"\"}));setEditEmployeeID(\"111\");return null;}if(!emp.length){toast({title:\"This email is not existed!\",status:\"warning\"});return null;}if(role===\"Admin\"&&emp[0].level<2){toast({title:\"You have no authorisation to access!\",status:\"warning\"});return null;}if(role===\"Admin\"&&emp[0].level<2){toast({title:\"You have no authorisation to access!\",status:\"warning\"});return null;}if(role===\"AdminManager\"&&emp[0].level<3){toast({title:\"You have no authorisation to access!\",status:\"warning\"});return null;}if(role===\"Manager\"&&emp[0].level<4){toast({title:\"You have no authorisation to access!\",status:\"warning\"});return null;}setLoginLevel(_objectSpread(_objectSpread({},loginLevel),{},{loginUser:emp[0].name,loginUserId:emp[0].id,loginLevel:role,loginEmail:email,login:true,leave_bal:emp[0].leave_bal,siteallows_fee:emp[0].siteallows_fee,perdiem_fee:emp[0].perdiem_fee,reporting_to:emp[0].reporting_to,reporting_email:emp[0].reporting_email}));setEditEmployeeID(emp[0].id);setPassword(\"\");//setStoredUser(emp[0]);\n};// const handleStaffClick = (e) => {\n//   console.log(\"Staff\");\n//   e.preventDefault();\n//   setRole(\"Staff\");\n//   handleSubmit(e);\n// };\n// const handleAdminClick = (e) => {\n//   e.preventDefault();\n//   setRole(\"Admin\");\n//   handleSubmit(e);\n// };\n// const handleAdminManagerClick = (e) => {\n//   e.preventDefault();\n//   setRole(\"AdminManager\");\n//   handleSubmit(e);\n// };\n// const handleManagerClick = (e) => {\n//   e.preventDefault();\n//   setRole(\"Manager\");\n//   // handleSubmit(e);\n// };\nreturn/*#__PURE__*/_jsx(Container,{minH:\"84vh\",align:\"center\",justify:\"center\",children:/*#__PURE__*/_jsx(Stack,{spacing:8,mx:\"auto\",w:\"xl\",py:12,px:6,children:/*#__PURE__*/_jsxs(Box,{bgColor:\"white\",children:[/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(AspectRatio,{w:\"400px\",h:\"200px\",ratio:1,children:/*#__PURE__*/_jsx(Wrap,{w:\"300px\",h:\"200px\",px:\"1rem\",spacing:4,justify:\"center\",children:/*#__PURE__*/_jsx(Image,{src:img,alt:\"Logo\",width:\"100%\",display:\"block\",fit:\"cover\"})})})}),/*#__PURE__*/_jsx(Stack,{align:\"center\",py:3,children:/*#__PURE__*/_jsx(Heading,{size:\"md\",children:\"Log In to Appsmiths Sutera HRMS\"})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(handleLogin),children:[/*#__PURE__*/_jsxs(VStack,{alignItems:\"flex-start\",px:5,py:5,m:5,borderRadius:\"20\",border:\"1px solid black\",children:[/*#__PURE__*/_jsx(FormControl,{children:/*#__PURE__*/_jsx(Controller,{control:control,name:\"email\"//defaultValue={email}\n,render:function render(_ref2){var _ref2$field=_ref2.field,_onChange=_ref2$field.onChange,value=_ref2$field.value,ref=_ref2$field.ref;return/*#__PURE__*/_jsx(InputGroup,{children:/*#__PURE__*/_jsx(HStack,{w:\"100%\",py:1,children:/*#__PURE__*/_jsx(Input,{name:\"email\",value:value//onChange={onChange}\n,onChange:function onChange(e){_onChange(e);setEmail(e.target.value);},bgColor:\"white\"//textTransform=\"capitalize\"\n,ref:ref,placeholder:\"email\"})})});}})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(FormControl,{children:/*#__PURE__*/_jsx(Controller,{control:control,name:\"password\"//defaultValue={name}\n,render:function render(_ref3){var _ref3$field=_ref3.field,_onChange2=_ref3$field.onChange,value=_ref3$field.value,ref=_ref3$field.ref;return/*#__PURE__*/_jsx(InputGroup,{children:/*#__PURE__*/_jsx(HStack,{w:\"100%\",py:1,children:/*#__PURE__*/_jsx(Input,{name:\"password\",type:\"password\",value:value,onChange:function onChange(e){_onChange2(e);setPassword(e.target.value);},bgColor:\"white\"//textTransform=\"capitalize\"\n,ref:ref,placeholder:\"password\"})})});}})})]}),/*#__PURE__*/_jsx(HStack,{align:\"center\",justify:\"center\",children:/*#__PURE__*/_jsx(Button,{mt:1,mx:5,mb:5,variant:\"solid\",isFullWidth:true,colorScheme:\"teal\",isLoading:isSubmitting,type:\"submit\",children:\"Login\"})})]})]})})});};var useStyles=makeStyles(function(theme){return{root:{display:\"flex\",flexDirection:\"column\",justifyContent:\"center\",alignItems:\"center\",padding:theme.spacing(2),\"& .MuiTextField-root\":{margin:theme.spacing(1),width:\"600px\"},\"& .MuiButtonBase-root\":{margin:theme.spacing(2)}}};});export default SigninForm;","map":{"version":3,"sources":["D:/react-myprojects/hrms-airtable/src/components/SigninForm.js"],"names":["React","useState","AspectRatio","Box","Button","Container","Divider","Flex","FormControl","Heading","Image","Input","InputGroup","InputLeftAddon","Stack","HStack","VStack","Wrap","makeStyles","Controller","useForm","useCustomToast","useEmployees","useRecoilState","loginLevelState","useEmployeesContext","img","App","initial_values","email","password","SigninForm","classes","useStyles","toast","field_width","employees","setEmail","setPassword","role","setRole","state","setState","loginLevel","setLoginLevel","setEditEmployeeID","defaultValues","handleSubmit","control","register","reset","formState","errors","isSubmitting","handleLogin","values","auth","signInWithEmailAndPassword","update_login","title","status","emp","filter","item","map","row","id","name","level","leave_bal","siteallows_fee","perdiem_fee","reporting_to","reporting_email","loginUser","loginUserId","loginEmail","login","length","field","onChange","value","ref","e","target","theme","root","display","flexDirection","justifyContent","alignItems","padding","spacing","margin","width"],"mappings":"4lBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA;AACA;AACA,OACEC,WADF,CAEEC,GAFF,CAGEC,MAHF,CAIEC,SAJF,CAKEC,OALF,CAMEC,IANF,CAOEC,WAPF,CAQEC,OARF,CASEC,KATF,CAUEC,KAVF,CAWEC,UAXF,CAYEC,cAZF,CAaEC,KAbF,CAcEC,MAdF,CAeEC,MAfF,CAgBEC,IAhBF,KAiBO,kBAjBP,CAkBA,OAASC,UAAT,KAA2B,0BAA3B,CACA,OAASC,UAAT,CAAqBC,OAArB,KAAoC,iBAApC,CACA,OAASC,cAAT,KAA+B,2BAA/B,CACA,OAASC,YAAT,KAA6B,0BAA7B,CACA,OAASC,cAAT,KAA+B,QAA/B,CACA,OAASC,eAAT,KAAgC,iBAAhC,CACA,OAASC,mBAAT,KAAoC,8BAApC,CACA;AACA;AACA,MAAOC,CAAAA,GAAP,KAAgB,0BAAhB,CACA,MAAOC,CAAAA,GAAP,KAAgB,mBAAhB,C,wFAEA,GAAMC,CAAAA,cAAc,CAAG,CACrBC,KAAK,CAAE,EADc,CAErBC,QAAQ,CAAE,EAFW,CAAvB,CAKA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB;AACA,GAAMC,CAAAA,OAAO,CAAGC,SAAS,EAAzB,CACA,GAAMC,CAAAA,KAAK,CAAGb,cAAc,EAA5B,CACA,GAAMc,CAAAA,WAAW,CAAG,IAApB,CACA;AALuB,kBAMDb,YAAY,EANX,CAMfc,SANe,eAMfA,SANe,eAOGnC,QAAQ,CAAC,EAAD,CAPX,wCAOhB4B,KAPgB,eAOTQ,QAPS,8BAQSpC,QAAQ,CAAC,EAAD,CARjB,yCAQhB6B,QARgB,eAQNQ,WARM,8BASCrC,QAAQ,CAAC,EAAD,CATT,yCAShBsC,IATgB,eASVC,OATU,8BAUGvC,QAAQ,CAAC2B,cAAD,CAVX,yCAUhBa,KAVgB,eAUTC,QAVS,mCAWanB,cAAc,CAACC,eAAD,CAX3B,oDAWhBmB,UAXgB,qBAWJC,aAXI,8CAYOnB,mBAAmB,EAZ1B,CAYfoB,iBAZe,sBAYfA,iBAZe,cAmBnBzB,OAAO,CAAC,CAAE0B,aAAa,CAAEL,KAAjB,CAAD,CAnBY,CAcrBM,YAdqB,UAcrBA,YAdqB,CAerBC,OAfqB,UAerBA,OAfqB,CAgBrBC,QAhBqB,UAgBrBA,QAhBqB,CAiBrBC,KAjBqB,UAiBrBA,KAjBqB,6BAkBrBC,SAlBqB,CAkBRC,MAlBQ,oBAkBRA,MAlBQ,CAkBAC,YAlBA,oBAkBAA,YAlBA,CAqBvB,GAAMC,CAAAA,WAAW,0FAAG,iBAAOC,MAAP,qIAClB;AACA;AACQ1B,KAHU,CAGU0B,MAHV,CAGV1B,KAHU,CAGHC,QAHG,CAGUyB,MAHV,CAGHzB,QAHG,uCAKVH,CAAAA,GAAG,CAAC6B,IAAJ,GAAWC,0BAAX,CAAsC5B,KAAtC,CAA6CC,QAA7C,CALU,QAMhB;AACA4B,YAAY,GAPI,+EAShBxB,KAAK,CAAC,CACJyB,KAAK,CAAE,4BADH,CAEJC,MAAM,CAAE,SAFJ,CAAD,CAAL,CATgB,oEAAH,kBAAXN,CAAAA,WAAW,4CAAjB,CAgBA,GAAMI,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzB,GAAMG,CAAAA,GAAG,CAAGzB,SAAS,CAClB0B,MADS,CACF,SAACC,IAAD,QAAUA,CAAAA,IAAI,CAAClC,KAAL,GAAeA,KAAzB,EADE,EAETmC,GAFS,CAEL,SAACC,GAAD,CAAS,CACZ,MAAO,CACLC,EAAE,CAAED,GAAG,CAACC,EADH,CAELC,IAAI,CAAEF,GAAG,CAACE,IAFL,CAGLtC,KAAK,CAAEoC,GAAG,CAACpC,KAHN,CAILC,QAAQ,CAAEmC,GAAG,CAACnC,QAJT,CAKLS,IAAI,CAAEA,IALD,CAML6B,KAAK,CAAEH,GAAG,CAAC1B,IANN,CAOL8B,SAAS,CAAEJ,GAAG,CAACI,SAPV,CAQLC,cAAc,CAAEL,GAAG,CAACK,cARf,CASLC,WAAW,CAAEN,GAAG,CAACM,WATZ,CAULC,YAAY,CAAEP,GAAG,CAACO,YAVb,CAWLC,eAAe,CAAER,GAAG,CAACQ,eAXhB,CAAP,CAaD,CAhBS,CAAZ,CAiBA,GAAI5C,KAAK,GAAK,eAAd,CAA+B,CAC7B;AACAW,OAAO,CAAC,OAAD,CAAP,CACAI,aAAa,gCACRD,UADQ,MAEX+B,SAAS,CAAE,OAFA,CAGXC,WAAW,CAAE,OAHF,CAIXhC,UAAU,CAAE,OAJD,CAKXiC,UAAU,CAAE,eALD,CAMXC,KAAK,CAAE,IANI,CAOXR,SAAS,CAAE,CAPA,CAQXC,cAAc,CAAE,CARL,CASXC,WAAW,CAAE,CATF,CAUXC,YAAY,CAAE,EAVH,CAWXC,eAAe,CAAE,EAXN,GAAb,CAaA5B,iBAAiB,CAAC,KAAD,CAAjB,CACA,MAAO,KAAP,CACD,CAED,GAAI,CAACgB,GAAG,CAACiB,MAAT,CAAiB,CACf5C,KAAK,CAAC,CACJyB,KAAK,CAAE,4BADH,CAEJC,MAAM,CAAE,SAFJ,CAAD,CAAL,CAIA,MAAO,KAAP,CACD,CAED,GAAIrB,IAAI,GAAK,OAAT,EAAoBsB,GAAG,CAAC,CAAD,CAAH,CAAOO,KAAP,CAAe,CAAvC,CAA0C,CACxClC,KAAK,CAAC,CACJyB,KAAK,CAAE,sCADH,CAEJC,MAAM,CAAE,SAFJ,CAAD,CAAL,CAIA,MAAO,KAAP,CACD,CACD,GAAIrB,IAAI,GAAK,OAAT,EAAoBsB,GAAG,CAAC,CAAD,CAAH,CAAOO,KAAP,CAAe,CAAvC,CAA0C,CACxClC,KAAK,CAAC,CACJyB,KAAK,CAAE,sCADH,CAEJC,MAAM,CAAE,SAFJ,CAAD,CAAL,CAIA,MAAO,KAAP,CACD,CACD,GAAIrB,IAAI,GAAK,cAAT,EAA2BsB,GAAG,CAAC,CAAD,CAAH,CAAOO,KAAP,CAAe,CAA9C,CAAiD,CAC/ClC,KAAK,CAAC,CACJyB,KAAK,CAAE,sCADH,CAEJC,MAAM,CAAE,SAFJ,CAAD,CAAL,CAIA,MAAO,KAAP,CACD,CACD,GAAIrB,IAAI,GAAK,SAAT,EAAsBsB,GAAG,CAAC,CAAD,CAAH,CAAOO,KAAP,CAAe,CAAzC,CAA4C,CAC1ClC,KAAK,CAAC,CACJyB,KAAK,CAAE,sCADH,CAEJC,MAAM,CAAE,SAFJ,CAAD,CAAL,CAIA,MAAO,KAAP,CACD,CAEDhB,aAAa,gCACRD,UADQ,MAEX+B,SAAS,CAAEb,GAAG,CAAC,CAAD,CAAH,CAAOM,IAFP,CAGXQ,WAAW,CAAEd,GAAG,CAAC,CAAD,CAAH,CAAOK,EAHT,CAIXvB,UAAU,CAAEJ,IAJD,CAKXqC,UAAU,CAAE/C,KALD,CAMXgD,KAAK,CAAE,IANI,CAOXR,SAAS,CAAER,GAAG,CAAC,CAAD,CAAH,CAAOQ,SAPP,CAQXC,cAAc,CAAET,GAAG,CAAC,CAAD,CAAH,CAAOS,cARZ,CASXC,WAAW,CAAEV,GAAG,CAAC,CAAD,CAAH,CAAOU,WATT,CAUXC,YAAY,CAAEX,GAAG,CAAC,CAAD,CAAH,CAAOW,YAVV,CAWXC,eAAe,CAAEZ,GAAG,CAAC,CAAD,CAAH,CAAOY,eAXb,GAAb,CAaA5B,iBAAiB,CAACgB,GAAG,CAAC,CAAD,CAAH,CAAOK,EAAR,CAAjB,CACA5B,WAAW,CAAC,EAAD,CAAX,CACA;AACD,CA3FD,CA6FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,mBACE,KAAC,SAAD,EAAW,IAAI,CAAC,MAAhB,CAAuB,KAAK,CAAC,QAA7B,CAAsC,OAAO,CAAC,QAA9C,uBACE,KAAC,KAAD,EAAO,OAAO,CAAE,CAAhB,CAAmB,EAAE,CAAC,MAAtB,CAA6B,CAAC,CAAC,IAA/B,CAAoC,EAAE,CAAE,EAAxC,CAA4C,EAAE,CAAE,CAAhD,uBACE,MAAC,GAAD,EAAK,OAAO,CAAC,OAAb,wBACE,KAAC,GAAD,wBACE,KAAC,WAAD,EAAa,CAAC,CAAC,OAAf,CAAuB,CAAC,CAAC,OAAzB,CAAiC,KAAK,CAAE,CAAxC,uBACE,KAAC,IAAD,EAAM,CAAC,CAAC,OAAR,CAAgB,CAAC,CAAC,OAAlB,CAA0B,EAAE,CAAC,MAA7B,CAAoC,OAAO,CAAE,CAA7C,CAAgD,OAAO,CAAC,QAAxD,uBACE,KAAC,KAAD,EACE,GAAG,CAAEZ,GADP,CAEE,GAAG,CAAC,MAFN,CAGE,KAAK,CAAC,MAHR,CAIE,OAAO,CAAC,OAJV,CAKE,GAAG,CAAC,OALN,EADF,EADF,EADF,EADF,cAcE,KAAC,KAAD,EAAO,KAAK,CAAC,QAAb,CAAsB,EAAE,CAAE,CAA1B,uBACE,KAAC,OAAD,EAAS,IAAI,CAAC,IAAd,6CADF,EAdF,cAiBE,cAAM,QAAQ,CAAEqB,YAAY,CAACO,WAAD,CAA5B,wBACE,MAAC,MAAD,EACE,UAAU,CAAC,YADb,CAEE,EAAE,CAAE,CAFN,CAGE,EAAE,CAAE,CAHN,CAIE,CAAC,CAAE,CAJL,CAKE,YAAY,CAAC,IALf,CAME,MAAM,CAAC,iBANT,wBAQE,KAAC,WAAD,wBACE,KAAC,UAAD,EACE,OAAO,CAAEN,OADX,CAEE,IAAI,CAAC,OACL;AAHF,CAKE,MAAM,CAAE,6CAAG+B,KAAH,CAAYC,SAAZ,aAAYA,QAAZ,CAAsBC,KAAtB,aAAsBA,KAAtB,CAA6BC,GAA7B,aAA6BA,GAA7B,oBACN,KAAC,UAAD,wBACE,KAAC,MAAD,EAAQ,CAAC,CAAC,MAAV,CAAiB,EAAE,CAAE,CAArB,uBAME,KAAC,KAAD,EACE,IAAI,CAAC,OADP,CAEE,KAAK,CAAED,KACP;AAHF,CAIE,QAAQ,CAAE,kBAACE,CAAD,CAAO,CACfH,SAAQ,CAACG,CAAD,CAAR,CACA9C,QAAQ,CAAC8C,CAAC,CAACC,MAAF,CAASH,KAAV,CAAR,CACD,CAPH,CAQE,OAAO,CAAC,OACR;AATF,CAUE,GAAG,CAAEC,GAVP,CAWE,WAAW,CAAC,OAXd,EANF,EADF,EADM,EALV,EADF,EARF,cAwCE,KAAC,OAAD,IAxCF,cAyCE,KAAC,WAAD,wBACE,KAAC,UAAD,EACE,OAAO,CAAElC,OADX,CAEE,IAAI,CAAC,UACL;AAHF,CAIE,MAAM,CAAE,6CAAG+B,KAAH,CAAYC,UAAZ,aAAYA,QAAZ,CAAsBC,KAAtB,aAAsBA,KAAtB,CAA6BC,GAA7B,aAA6BA,GAA7B,oBACN,KAAC,UAAD,wBACE,KAAC,MAAD,EAAQ,CAAC,CAAC,MAAV,CAAiB,EAAE,CAAE,CAArB,uBAME,KAAC,KAAD,EACE,IAAI,CAAC,UADP,CAEE,IAAI,CAAC,UAFP,CAGE,KAAK,CAAED,KAHT,CAIE,QAAQ,CAAE,kBAACE,CAAD,CAAO,CACfH,UAAQ,CAACG,CAAD,CAAR,CACA7C,WAAW,CAAC6C,CAAC,CAACC,MAAF,CAASH,KAAV,CAAX,CACD,CAPH,CAQE,OAAO,CAAC,OACR;AATF,CAUE,GAAG,CAAEC,GAVP,CAWE,WAAW,CAAC,UAXd,EANF,EADF,EADM,EAJV,EADF,EAzCF,GADF,cA0EE,KAAC,MAAD,EAAQ,KAAK,CAAC,QAAd,CAAuB,OAAO,CAAC,QAA/B,uBACE,KAAC,MAAD,EACE,EAAE,CAAE,CADN,CAEE,EAAE,CAAE,CAFN,CAGE,EAAE,CAAE,CAHN,CAIE,OAAO,CAAC,OAJV,CAKE,WAAW,KALb,CAME,WAAW,CAAC,MANd,CAOE,SAAS,CAAE7B,YAPb,CAQE,IAAI,CAAC,QARP,mBADF,EA1EF,GAjBF,GADF,EADF,EADF,CAiHD,CAzQD,CA2QA,GAAMpB,CAAAA,SAAS,CAAGf,UAAU,CAAC,SAACmE,KAAD,QAAY,CACvCC,IAAI,CAAE,CACJC,OAAO,CAAE,MADL,CAEJC,aAAa,CAAE,QAFX,CAGJC,cAAc,CAAE,QAHZ,CAIJC,UAAU,CAAE,QAJR,CAKJC,OAAO,CAAEN,KAAK,CAACO,OAAN,CAAc,CAAd,CALL,CAOJ,uBAAwB,CACtBC,MAAM,CAAER,KAAK,CAACO,OAAN,CAAc,CAAd,CADc,CAEtBE,KAAK,CAAE,OAFe,CAPpB,CAWJ,wBAAyB,CACvBD,MAAM,CAAER,KAAK,CAACO,OAAN,CAAc,CAAd,CADe,CAXrB,CADiC,CAAZ,EAAD,CAA5B,CAkBA,cAAe7D,CAAAA,UAAf","sourcesContent":["import React, { useState } from \"react\";\r\n//import { useHistory } from \"react-router-dom\";\r\n//import { Button, TextField } from \"@material-ui/core\";\r\nimport {\r\n  AspectRatio,\r\n  Box,\r\n  Button,\r\n  Container,\r\n  Divider,\r\n  Flex,\r\n  FormControl,\r\n  Heading,\r\n  Image,\r\n  Input,\r\n  InputGroup,\r\n  InputLeftAddon,\r\n  Stack,\r\n  HStack,\r\n  VStack,\r\n  Wrap,\r\n} from \"@chakra-ui/react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { Controller, useForm } from \"react-hook-form\";\r\nimport { useCustomToast } from \"../helpers/useCustomToast\";\r\nimport { useEmployees } from \"./employees/useEmployees\";\r\nimport { useRecoilState } from \"recoil\";\r\nimport { loginLevelState } from \"./data/atomdata\";\r\nimport { useEmployeesContext } from \"../context/employees_context\";\r\n//import { setStoredUser } from \"./user-storage\";\r\n//import { useAuthContext } from \"../context/auth_context\";\r\nimport img from \"../assets/AppSutLogo.jpg\";\r\nimport App from \"../utils/firebase\";\r\n\r\nconst initial_values = {\r\n  email: \"\",\r\n  password: \"\",\r\n};\r\n\r\nconst SigninForm = () => {\r\n  //let history = useHistory();\r\n  const classes = useStyles();\r\n  const toast = useCustomToast();\r\n  const field_width = \"40\";\r\n  //const { currentUser } = useAuthContext();\r\n  const { employees } = useEmployees();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [role, setRole] = useState(\"\");\r\n  const [state, setState] = useState(initial_values);\r\n  const [loginLevel, setLoginLevel] = useRecoilState(loginLevelState);\r\n  const { setEditEmployeeID } = useEmployeesContext();\r\n  const {\r\n    handleSubmit,\r\n    control,\r\n    register,\r\n    reset,\r\n    formState: { errors, isSubmitting },\r\n  } = useForm({ defaultValues: state });\r\n\r\n  const handleLogin = async (values) => {\r\n    //event.preventDefault();\r\n    //console.log(\"sigin\", values);\r\n    const { email, password } = values;\r\n    try {\r\n      await App.auth().signInWithEmailAndPassword(email, password);\r\n      //history.pushState(\"/\");\r\n      update_login();\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Invalid email or password!\",\r\n        status: \"warning\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const update_login = () => {\r\n    const emp = employees\r\n      .filter((item) => item.email === email)\r\n      .map((row) => {\r\n        return {\r\n          id: row.id,\r\n          name: row.name,\r\n          email: row.email,\r\n          password: row.password,\r\n          role: role,\r\n          level: row.role,\r\n          leave_bal: row.leave_bal,\r\n          siteallows_fee: row.siteallows_fee,\r\n          perdiem_fee: row.perdiem_fee,\r\n          reporting_to: row.reporting_to,\r\n          reporting_email: row.reporting_email,\r\n        };\r\n      });\r\n    if (email === \"admin@abc.com\") {\r\n      //setRole(role);\r\n      setRole(\"Staff\");\r\n      setLoginLevel({\r\n        ...loginLevel,\r\n        loginUser: \"Admin\",\r\n        loginUserId: \"admin\",\r\n        loginLevel: \"Staff\",\r\n        loginEmail: \"admin@abc.com\",\r\n        login: true,\r\n        leave_bal: 0,\r\n        siteallows_fee: 0,\r\n        perdiem_fee: 0,\r\n        reporting_to: \"\",\r\n        reporting_email: \"\",\r\n      });\r\n      setEditEmployeeID(\"111\");\r\n      return null;\r\n    }\r\n\r\n    if (!emp.length) {\r\n      toast({\r\n        title: \"This email is not existed!\",\r\n        status: \"warning\",\r\n      });\r\n      return null;\r\n    }\r\n\r\n    if (role === \"Admin\" && emp[0].level < 2) {\r\n      toast({\r\n        title: \"You have no authorisation to access!\",\r\n        status: \"warning\",\r\n      });\r\n      return null;\r\n    }\r\n    if (role === \"Admin\" && emp[0].level < 2) {\r\n      toast({\r\n        title: \"You have no authorisation to access!\",\r\n        status: \"warning\",\r\n      });\r\n      return null;\r\n    }\r\n    if (role === \"AdminManager\" && emp[0].level < 3) {\r\n      toast({\r\n        title: \"You have no authorisation to access!\",\r\n        status: \"warning\",\r\n      });\r\n      return null;\r\n    }\r\n    if (role === \"Manager\" && emp[0].level < 4) {\r\n      toast({\r\n        title: \"You have no authorisation to access!\",\r\n        status: \"warning\",\r\n      });\r\n      return null;\r\n    }\r\n\r\n    setLoginLevel({\r\n      ...loginLevel,\r\n      loginUser: emp[0].name,\r\n      loginUserId: emp[0].id,\r\n      loginLevel: role,\r\n      loginEmail: email,\r\n      login: true,\r\n      leave_bal: emp[0].leave_bal,\r\n      siteallows_fee: emp[0].siteallows_fee,\r\n      perdiem_fee: emp[0].perdiem_fee,\r\n      reporting_to: emp[0].reporting_to,\r\n      reporting_email: emp[0].reporting_email,\r\n    });\r\n    setEditEmployeeID(emp[0].id);\r\n    setPassword(\"\");\r\n    //setStoredUser(emp[0]);\r\n  };\r\n\r\n  // const handleStaffClick = (e) => {\r\n  //   console.log(\"Staff\");\r\n  //   e.preventDefault();\r\n  //   setRole(\"Staff\");\r\n  //   handleSubmit(e);\r\n  // };\r\n  // const handleAdminClick = (e) => {\r\n  //   e.preventDefault();\r\n  //   setRole(\"Admin\");\r\n  //   handleSubmit(e);\r\n  // };\r\n  // const handleAdminManagerClick = (e) => {\r\n  //   e.preventDefault();\r\n  //   setRole(\"AdminManager\");\r\n  //   handleSubmit(e);\r\n  // };\r\n  // const handleManagerClick = (e) => {\r\n  //   e.preventDefault();\r\n  //   setRole(\"Manager\");\r\n  //   // handleSubmit(e);\r\n  // };\r\n\r\n  return (\r\n    <Container minH=\"84vh\" align=\"center\" justify=\"center\">\r\n      <Stack spacing={8} mx=\"auto\" w=\"xl\" py={12} px={6}>\r\n        <Box bgColor=\"white\">\r\n          <Box>\r\n            <AspectRatio w=\"400px\" h=\"200px\" ratio={1}>\r\n              <Wrap w=\"300px\" h=\"200px\" px=\"1rem\" spacing={4} justify=\"center\">\r\n                <Image\r\n                  src={img}\r\n                  alt=\"Logo\"\r\n                  width=\"100%\"\r\n                  display=\"block\"\r\n                  fit=\"cover\"\r\n                />\r\n              </Wrap>\r\n            </AspectRatio>\r\n          </Box>\r\n          <Stack align=\"center\" py={3}>\r\n            <Heading size=\"md\">Log In to Appsmiths Sutera HRMS</Heading>\r\n          </Stack>\r\n          <form onSubmit={handleSubmit(handleLogin)}>\r\n            <VStack\r\n              alignItems=\"flex-start\"\r\n              px={5}\r\n              py={5}\r\n              m={5}\r\n              borderRadius=\"20\"\r\n              border=\"1px solid black\"\r\n            >\r\n              <FormControl>\r\n                <Controller\r\n                  control={control}\r\n                  name=\"email\"\r\n                  //defaultValue={email}\r\n\r\n                  render={({ field: { onChange, value, ref } }) => (\r\n                    <InputGroup>\r\n                      <HStack w=\"100%\" py={1}>\r\n                        {/* <InputLeftAddon\r\n                          children=\"Email\"\r\n                          minWidth={field_width}\r\n                          bgColor=\"gray.300\"\r\n                        /> */}\r\n                        <Input\r\n                          name=\"email\"\r\n                          value={value}\r\n                          //onChange={onChange}\r\n                          onChange={(e) => {\r\n                            onChange(e);\r\n                            setEmail(e.target.value);\r\n                          }}\r\n                          bgColor=\"white\"\r\n                          //textTransform=\"capitalize\"\r\n                          ref={ref}\r\n                          placeholder=\"email\"\r\n                        />\r\n                      </HStack>\r\n                    </InputGroup>\r\n                  )}\r\n                />\r\n              </FormControl>\r\n              <Divider />\r\n              <FormControl>\r\n                <Controller\r\n                  control={control}\r\n                  name=\"password\"\r\n                  //defaultValue={name}\r\n                  render={({ field: { onChange, value, ref } }) => (\r\n                    <InputGroup>\r\n                      <HStack w=\"100%\" py={1}>\r\n                        {/* <InputLeftAddon\r\n                          children=\"Password\"\r\n                          minWidth={field_width}\r\n                          bgColor=\"gray.300\"\r\n                        /> */}\r\n                        <Input\r\n                          name=\"password\"\r\n                          type=\"password\"\r\n                          value={value}\r\n                          onChange={(e) => {\r\n                            onChange(e);\r\n                            setPassword(e.target.value);\r\n                          }}\r\n                          bgColor=\"white\"\r\n                          //textTransform=\"capitalize\"\r\n                          ref={ref}\r\n                          placeholder=\"password\"\r\n                        />\r\n                      </HStack>\r\n                    </InputGroup>\r\n                  )}\r\n                />\r\n              </FormControl>\r\n            </VStack>\r\n            <HStack align=\"center\" justify=\"center\">\r\n              <Button\r\n                mt={1}\r\n                mx={5}\r\n                mb={5}\r\n                variant=\"solid\"\r\n                isFullWidth\r\n                colorScheme=\"teal\"\r\n                isLoading={isSubmitting}\r\n                type=\"submit\"\r\n              >\r\n                Login\r\n              </Button>\r\n            </HStack>\r\n          </form>\r\n        </Box>\r\n      </Stack>\r\n    </Container>\r\n  );\r\n};\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    padding: theme.spacing(2),\r\n\r\n    \"& .MuiTextField-root\": {\r\n      margin: theme.spacing(1),\r\n      width: \"600px\",\r\n    },\r\n    \"& .MuiButtonBase-root\": {\r\n      margin: theme.spacing(2),\r\n    },\r\n  },\r\n}));\r\n\r\nexport default SigninForm;\r\n"]},"metadata":{},"sourceType":"module"}